var paper=new function(){var R,da,ea,N,n=new function(){function a(a,b,c){if(y)try{return delete a[b],y(a,b,c)}catch(d){}(c.get||c.set)&&a.__defineGetter__?(c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)):a[b]=c.value;return a}function b(a,b){if(v)try{return v(a,b)}catch(c){}var d=a.__lookupGetter__&&a.__lookupGetter__(b);return d?{get:d,set:a.__lookupSetter__(b),enumerable:!0,configurable:!0}:m.call(a,b)?{value:a[b],enumerable:!0,configurable:!0,writable:!0}:null}function c(c,
d,e,f,g,i){function l(h,i,q,s){var i=i||(i=b(d,h))&&(i.get?i:i.value),n="function"===typeof i,v=i,y=g||n?i&&i.get?h in c:c[h]:null;if(s&&n&&(!g||!s[h]))s[h]=function(a){return a&&c[h].apply(a,j.call(arguments,1))};if((q||void 0!==i&&m.call(d,h))&&(!g||!y)){if(n){if(y&&/\bthis\.base\b/.test(i)){var t=f&&f[h]==y,v=function(){var c=b(this,"base");a(this,"base",{value:t?f[h]:y,configurable:!0});try{return i.apply(this,arguments)}finally{c?a(this,"base",c):delete this.base}};v.toString=function(){return i.toString()};
v.valueOf=function(){return i.valueOf()}}p&&0==i.length&&(o=h.match(/^(get|is)(([A-Z])(.*))$/))&&p.push([o[3].toLowerCase()+o[4],o[2]])}if(!v||n||!v.get&&!v.set)v={value:v,writable:!0};if((b(c,h)||{configurable:!0}).configurable)v.configurable=!0,v.enumerable=e;a(c,h,v)}}var p,o;if(d){p=[];for(var q in d)m.call(d,q)&&!h.test(q)&&l(q,null,!0,i);l("toString");l("valueOf");i=0;for(q=p&&p.length;i<q;i++)try{o=p[i];var s=o[1];l(o[0],{get:c["get"+s]||c["is"+s],set:c["set"+s]},!0)}catch(n){}}return c}function d(b){var c=
function(d){g&&a(this,"__proto__",{value:b});if(this.initialize&&d!==c.dont)return this.initialize.apply(this,arguments)};c.prototype=b;c.toString=function(){return(this.prototype.initialize||function(){}).toString()};return c}function e(a){return!a?function(a){return a}:"function"!==typeof a?function(b){return b==a}:a}function f(a,b,c,d){try{a&&(d||void 0===d&&o(a)?q:s).call(a,e(b),c=c||a)}catch(f){if(f!==n.stop)throw f;}return c}function i(a){return f(a,function(a,b){this[b]=a},new a.constructor)}
var g=!this.__proto__,h=/^(statics|generics|preserve|enumerable|prototype|__proto__|toString|valueOf)$/,l=Object.prototype,m=g?function(a){return"__proto__"!==a&&this.hasOwnProperty(a)}:l.hasOwnProperty,p=l.toString,l=Array.prototype,o=Array.isArray=Array.isArray||function(a){return"[object Array]"===p.call(a)},j=l.slice,q=l.forEach=l.forEach||function(a,b){for(var c=0,d=this.length;c<d;c++)a.call(b,this[c],c,this)},s=function(a,b){for(var c in this)this.hasOwnProperty(c)&&a.call(b,this[c],c,this)},
y=Object.defineProperty,v=Object.getOwnPropertyDescriptor;return c(function(){},{inject:function(a){if(a){var b=this.prototype,d=b.__proto__&&b.__proto__.constructor,e=!0==a.statics?a:a.statics;e!=a&&c(b,a,a.enumerable,d&&d.prototype,a.preserve,a.generics&&this);c(this,e,!0,d,a.preserve)}b=1;for(d=arguments.length;b<d;b++)this.inject(arguments[b]);return this},extend:function(b){var e=new this(this.dont),f=d(e);a(e,"constructor",{value:f,writable:!0,configurable:!0});f.dont={};c(f,this,!0);return arguments.length?
this.inject.apply(f,arguments):f}},!0).inject({has:m,each:f,inject:function(){for(var a=0,b=arguments.length;a<b;a++)c(this,arguments[a]);return this},extend:function(){var a=new (d(this));return a.inject.apply(a,arguments)},each:function(a,b){return f(this,a,b)},clone:function(){return i(this)},statics:{each:f,clone:i,define:a,describe:b,iterator:e,has:function(a,b){return m.call(a,b)},type:function(a){return(a||0===a)&&(a._type||typeof a)||null},check:function(a){return!!(a||0===a)},pick:function(){for(var a=
0,b=arguments.length;a<b;a++)if(void 0!==arguments[a])return arguments[a];return null},stop:{}}})};this.Base=n.inject({generics:!0,clone:function(){return new this.constructor(this)},toString:function(){return"{ "+n.each(this,function(a,b){if("_"!=b.charAt(0)){var c=typeof a;this.push(b+": "+("number"===c?n.formatNumber(a):"string"===c?"'"+a+"'":a))}},[]).join(", ")+" }"},statics:{read:function(a,b,c){var b=b||0,c=c||a.length-b,d=a[b];if(d instanceof this||this.prototype._readNull&&null==d&&1>=c)return d;
d=new this(this.dont);return d.initialize.apply(d,0<b||c<a.length?Array.prototype.slice.call(a,b,b+c):a)||d},readAll:function(a,b){for(var c=[],d,e=b||0,f=a.length;e<f;e++)c.push(Array.isArray(d=a[e])?this.read(d,0):this.read(a,e,1));return c},splice:function(a,b,c,d){for(var e=b&&b.length,f=void 0===c,c=f?a.length:c,i=0;i<e;i++)b[i]._index=c+i;if(f)return a.push.apply(a,b),[];i=[c,d];b&&i.push.apply(i,b);b=a.splice.apply(a,i);i=0;for(d=b.length;i<d;i++)delete b[i]._index;i=c+e;for(d=a.length;i<d;i++)a[i]._index=
i;return b},merge:function(){return n.each(arguments,function(a){n.each(a,function(a,c){this[c]=a},this)},new n,!0)},capitalize:function(a){return a.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},camelize:function(a){return a.replace(/-(\w)/g,function(a,c){return c.toUpperCase()})},hyphenate:function(a){return a.replace(/[a-z][A-Z0-9]|[0-9][a-zA-Z]|[A-Z]{2}[a-z]/g,function(a){return a.charAt(0)+"-"+a.substring(1)}).toLowerCase()},formatNumber:function(a){return(Math.round(1E5*a)/1E5).toString()}}});
var Y=this.PaperScope=n.extend({initialize:function(a){paper=this;this.view=null;this.views=[];this.project=null;this.projects=[];this.tool=null;this.tools=[];this._id=a&&(a.getAttribute("id")||a.src)||"paperscope-"+Y._id++;a&&a.setAttribute("id",this._id);Y._scopes[this._id]=this},version:0.21,evaluate:function(a){a=fa.evaluate(a,this);K.updateFocus();return a},install:function(a){var b=this;n.each(["project","view","tool"],function(c){n.define(a,c,{configurable:!0,writable:!0,get:function(){return b[c]}})});
for(var c in this)!/^(version|_id|load)/.test(c)&&!(c in a)&&(a[c]=this[c])},setup:function(a){paper=this;this.project=new Aa;if(a)this.view=new K(a)},clear:function(){for(var a=this.projects.length-1;0<=a;a--)this.projects[a].remove();for(a=this.views.length-1;0<=a;a--)this.views[a].remove();for(a=this.tools.length-1;0<=a;a--)this.tools[a].remove()},remove:function(){this.clear();delete Y._scopes[this._id]},_needsRedraw:function(){if(!this._redrawNotified){for(var a=this.views.length-1;0<=a;a--)this.views[a]._redrawNeeded=
!0;this._redrawNotified=!0}},statics:{_scopes:{},_id:0,get:function(a){"object"===typeof a&&(a=a.getAttribute("id"));return this._scopes[a]||null},each:function(a){n.each(this._scopes,a)}}}),ka=n.extend({initialize:function(a){this._scope=paper;this._index=this._scope[this._list].push(this)-1;(a||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;this._scope[this._reference]=this;return!0},remove:function(){if(null==this._index)return!1;n.splice(this._scope[this._list],
null,this._index,1);this._scope[this._reference]==this&&(this._scope[this._reference]=null);this._scope=null;return!0}}),j=this.Point=n.extend({initialize:function(a,b){void 0!==b?(this.x=a,this.y=b):void 0!==a?null==a?this.x=this.y=0:void 0!==a.x?(this.x=a.x,this.y=a.y):void 0!==a.width?(this.x=a.width,this.y=a.height):Array.isArray(a)?(this.x=a[0],this.y=1<a.length?a[1]:a[0]):void 0!==a.angle?(this.x=a.length,this.y=0,this.setAngle(a.angle)):this.x="number"===typeof a?this.y=a:this.y=0:this.x=this.y=
0},set:function(a,b){this.x=a;this.y=b;return this},clone:function(){return j.create(this.x,this.y)},toString:function(){var a=n.formatNumber;return"{ x: "+a(this.x)+", y: "+a(this.y)+" }"},add:function(a){a=j.read(arguments);return j.create(this.x+a.x,this.y+a.y)},subtract:function(a){a=j.read(arguments);return j.create(this.x-a.x,this.y-a.y)},multiply:function(a){a=j.read(arguments);return j.create(this.x*a.x,this.y*a.y)},divide:function(a){a=j.read(arguments);return j.create(this.x/a.x,this.y/
a.y)},modulo:function(a){a=j.read(arguments);return j.create(this.x%a.x,this.y%a.y)},negate:function(){return j.create(-this.x,-this.y)},transform:function(a){return a?a._transformPoint(this):this},getDistance:function(a,b){var a=j.read(arguments),c=a.x-this.x,d=a.y-this.y,c=c*c+d*d;return b?c:Math.sqrt(c)},getLength:function(a){var b=this.x*this.x+this.y*this.y;return a?b:Math.sqrt(b)},setLength:function(a){if(this.isZero()){var b=this._angle||0;this.set(Math.cos(b)*a,Math.sin(b)*a)}else a/=this.getLength(),
0==a&&this.getAngle(),this.set(this.x*a,this.y*a);return this},normalize:function(a){void 0===a&&(a=1);var b=this.getLength(),a=0!=b?a/b:0,a=j.create(this.x*a,this.y*a);a._angle=this._angle;return a},getAngle:function(a){return 180*this.getAngleInRadians(a)/Math.PI},setAngle:function(a){a=this._angle=a*Math.PI/180;if(!this.isZero()){var b=this.getLength();this.set(Math.cos(a)*b,Math.sin(a)*b)}return this},getAngleInRadians:function(){if(void 0===arguments[0]){if(null==this._angle)this._angle=Math.atan2(this.y,
this.x);return this._angle}var a=j.read(arguments),b=this.getLength()*a.getLength();return 0==b?NaN:Math.acos(this.dot(a)/b)},getAngleInDegrees:function(a){return this.getAngle(a)},getQuadrant:function(){return 0<=this.x?0<=this.y?1:4:0<=this.y?2:3},getDirectedAngle:function(a){a=j.read(arguments);return 180*Math.atan2(this.cross(a),this.dot(a))/Math.PI},rotate:function(a,b){var a=a*Math.PI/180,c=b?this.subtract(b):this,d=Math.sin(a),e=Math.cos(a),c=j.create(c.x*e-c.y*d,c.y*e+c.x*d);return b?c.add(b):
c},equals:function(a){a=j.read(arguments);return this.x==a.x&&this.y==a.y},isInside:function(a){return a.contains(this)},isClose:function(a,b){return this.getDistance(a)<b},isColinear:function(a){return this.cross(a)<J.TOLERANCE},isOrthogonal:function(a){return this.dot(a)<J.TOLERANCE},isZero:function(){return 0==this.x&&0==this.y},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(a){a=j.read(arguments);return this.x*a.x+this.y*a.y},cross:function(a){a=j.read(arguments);return this.x*
a.y-this.y*a.x},project:function(a){a=j.read(arguments);if(a.isZero())return j.create(0,0);var b=this.dot(a)/a.dot(a);return j.create(a.x*b,a.y*b)},statics:{create:function(a,b){var c=new j(j.dont);c.x=a;c.y=b;return c},min:function(a,b){a=j.read(arguments,0,1);b=j.read(arguments,1,1);return j.create(Math.min(a.x,b.x),Math.min(a.y,b.y))},max:function(a,b){a=j.read(arguments,0,1);b=j.read(arguments,1,1);return j.create(Math.max(a.x,b.x),Math.max(a.y,b.y))},random:function(){return j.create(Math.random(),
Math.random())}}},new function(){return n.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return j.create(b(this.x),b(this.y))}},{})}),aa=j.extend({set:function(a,b,c){this._x=a;this._y=b;if(!c)this._owner[this._setter](this);return this},getX:function(){return this._x},setX:function(a){this._x=a;this._owner[this._setter](this)},getY:function(){return this._y},setY:function(a){this._y=a;this._owner[this._setter](this)},statics:{create:function(a,b,c,d){var e=new aa(aa.dont);
e._x=c;e._y=d;e._owner=a;e._setter=b;return e}}}),r=this.Size=n.extend({initialize:function(a,b){void 0!==b?(this.width=a,this.height=b):void 0!==a?null==a?this.width=this.height=0:void 0!==a.width?(this.width=a.width,this.height=a.height):void 0!==a.x?(this.width=a.x,this.height=a.y):Array.isArray(a)?(this.width=a[0],this.height=1<a.length?a[1]:a[0]):this.width="number"===typeof a?this.height=a:this.height=0:this.width=this.height=0},toString:function(){var a=n.formatNumber;return"{ width: "+a(this.width)+
", height: "+a(this.height)+" }"},set:function(a,b){this.width=a;this.height=b;return this},clone:function(){return r.create(this.width,this.height)},add:function(a){a=r.read(arguments);return r.create(this.width+a.width,this.height+a.height)},subtract:function(a){a=r.read(arguments);return r.create(this.width-a.width,this.height-a.height)},multiply:function(a){a=r.read(arguments);return r.create(this.width*a.width,this.height*a.height)},divide:function(a){a=r.read(arguments);return r.create(this.width/
a.width,this.height/a.height)},modulo:function(a){a=r.read(arguments);return r.create(this.width%a.width,this.height%a.height)},negate:function(){return r.create(-this.width,-this.height)},equals:function(a){a=r.read(arguments);return this.width==a.width&&this.height==a.height},isZero:function(){return 0==this.width&&0==this.width},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{create:function(a,b){return(new r(r.dont)).set(a,b)},min:function(a,b){return r.create(Math.min(a.width,
b.width),Math.min(a.height,b.height))},max:function(a,b){return r.create(Math.max(a.width,b.width),Math.max(a.height,b.height))},random:function(){return r.create(Math.random(),Math.random())}}},new function(){return n.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return r.create(b(this.width),b(this.height))}},{})}),ga=r.extend({set:function(a,b,c){this._width=a;this._height=b;if(!c)this._owner[this._setter](this);return this},getWidth:function(){return this._width},
setWidth:function(a){this._width=a;this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(a){this._height=a;this._owner[this._setter](this)},statics:{create:function(a,b,c,d){var e=new ga(ga.dont);e._width=c;e._height=d;e._owner=a;e._setter=b;return e}}}),u=this.Rectangle=n.extend({initialize:function(a,b,c,d){if(4==arguments.length)this.x=a,this.y=b,this.width=c,this.height=d;else if(2==arguments.length)if(b&&void 0!==b.x){var e=j.read(arguments,0,1),f=j.read(arguments,
1,1);this.x=e.x;this.y=e.y;this.width=f.x-e.x;this.height=f.y-e.y;if(0>this.width)this.x=f.x,this.width=-this.width;if(0>this.height)this.y=f.y,this.height=-this.height}else e=j.read(arguments,0,1),f=r.read(arguments,1,1),this.x=e.x,this.y=e.y,this.width=f.width,this.height=f.height;else a?(this.x=a.x||0,this.y=a.y||0,this.width=a.width||0,this.height=a.height||0):this.x=this.y=this.width=this.height=0},set:function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d;return this},getPoint:function(){return aa.create(this,
"setPoint",this.x,this.y)},setPoint:function(a){a=j.read(arguments);this.x=a.x;this.y=a.y;return this},getSize:function(){return ga.create(this,"setSize",this.width,this.height)},setSize:function(a){a=r.read(arguments);this.width=a.width;this.height=a.height;return this},getLeft:function(){return this.x},setLeft:function(a){this.width-=a-this.x;this.x=a;return this},getTop:function(){return this.y},setTop:function(a){this.height-=a-this.y;this.y=a;return this},getRight:function(){return this.x+this.width},
setRight:function(a){this.width=a-this.x;return this},getBottom:function(){return this.y+this.height},setBottom:function(a){this.height=a-this.y;return this},getCenterX:function(){return this.x+0.5*this.width},setCenterX:function(a){this.x=a-0.5*this.width;return this},getCenterY:function(){return this.y+0.5*this.height},setCenterY:function(a){this.y=a-0.5*this.height;return this},getCenter:function(){return aa.create(this,"setCenter",this.getCenterX(),this.getCenterY())},setCenter:function(a){a=
j.read(arguments);return this.setCenterX(a.x).setCenterY(a.y)},equals:function(a){a=u.read(arguments);return this.x==a.x&&this.y==a.y&&this.width==a.width&&this.height==a.height},isEmpty:function(){return 0==this.width||0==this.height},toString:function(){var a=n.formatNumber;return"{ x: "+a(this.x)+", y: "+a(this.y)+", width: "+a(this.width)+", height: "+a(this.height)+" }"},contains:function(a){return a&&void 0!==a.width||4==(Array.isArray(a)?a:arguments).length?this._containsRectangle(u.read(arguments)):
this._containsPoint(j.read(arguments))},_containsPoint:function(a){var b=a.x,a=a.y;return b>=this.x&&a>=this.y&&b<=this.x+this.width&&a<=this.y+this.height},_containsRectangle:function(a){var b=a.x,c=a.y;return b>=this.x&&c>=this.y&&b+a.width<=this.x+this.width&&c+a.height<=this.y+this.height},intersects:function(a){a=u.read(arguments);return a.x+a.width>this.x&&a.y+a.height>this.y&&a.x<this.x+this.width&&a.y<this.y+this.height},intersect:function(a){var a=u.read(arguments),b=Math.max(this.x,a.x),
c=Math.max(this.y,a.y),d=Math.min(this.x+this.width,a.x+a.width),e=Math.min(this.y+this.height,a.y+a.height);return u.create(b,c,d-b,e-c)},unite:function(a){var a=u.read(arguments),b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x+a.width),e=Math.max(this.y+this.height,a.y+a.height);return u.create(b,c,d-b,e-c)},include:function(a){var a=j.read(arguments),b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x),e=Math.max(this.y+this.height,a.y);
return u.create(b,c,d-b,e-c)},expand:function(a,b){void 0===b&&(b=a);return u.create(this.x-a/2,this.y-b/2,this.width+a,this.height+b)},scale:function(a,b){return this.expand(this.width*a-this.width,this.height*(void 0===b?a:b)-this.height)},statics:{create:function(a,b,c,d){return(new u(u.dont)).set(a,b,c,d)}}},new function(){return n.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(a,b){var c=
a.join(""),d=/^[RL]/.test(c);4<=b&&(a[1]+=d?"Y":"X");var e=a[d?0:1],d=a[d?1:0],f="get"+e,i="get"+d,g="set"+e,h="set"+d,l="set"+c;this["get"+c]=function(){return aa.create(this,l,this[f](),this[i]())};this[l]=function(a){a=j.read(arguments);return this[g](a.x)[h](a.y)}},{})}),la=u.extend({set:function(a,b,c,d,e){this._x=a;this._y=b;this._width=c;this._height=d;if(!e)this._owner[this._setter](this);return this},statics:{create:function(a,b,c,d,e,f){c=(new la(la.dont)).set(c,d,e,f,!0);c._owner=a;c._setter=
b;return c}}},new function(){var a=u.prototype;return n.each(["x","y","width","height"],function(a){var c=n.capitalize(a),d="_"+a;this["get"+c]=function(){return this[d]};this["set"+c]=function(a){this[d]=a;if(!this._dontNotify)this._owner[this._setter](this)}},n.each("Point,Size,Center,Left,Top,Right,Bottom,CenterX,CenterY,TopLeft,TopRight,BottomLeft,BottomRight,LeftCenter,TopCenter,RightCenter,BottomCenter".split(","),function(b){var c="set"+b;this[c]=function(b){this._dontNotify=!0;a[c].apply(this,
arguments);delete this._dontNotify;this._owner[this._setter](this);return this}},{}))}),z=this.Matrix=n.extend({initialize:function(a){var b=arguments.length,c=!0;6==b?this.set.apply(this,arguments):1==b?a instanceof z?this.set(a._a,a._c,a._b,a._d,a._tx,a._ty):Array.isArray(a)?this.set.apply(this,a):c=!1:0==b?(this._a=this._d=1,this._c=this._b=this._tx=this._ty=0):c=!1;if(!c)throw Error("Unsupported matrix parameters");},clone:function(){return z.create(this._a,this._c,this._b,this._d,this._tx,this._ty)},
set:function(a,b,c,d,e,f){this._a=a;this._c=b;this._b=c;this._d=d;this._tx=e;this._ty=f;return this},scale:function(a,b,c){2>arguments.length||"object"===typeof b?(c=j.read(arguments,1),b=a):c=j.read(arguments,2);c&&this.translate(c);this._a*=a;this._c*=a;this._b*=b;this._d*=b;c&&this.translate(c.negate());return this},translate:function(a){var a=j.read(arguments),b=a.x,c=a.y;this._tx+=b*this._a+c*this._b;this._ty+=b*this._c+c*this._d;return this},rotate:function(a,b){return this.concatenate(z.getRotateInstance.apply(z,
arguments))},shear:function(a,b,c){2>arguments.length||"object"===typeof b?(c=j.read(arguments,1),b=a):c=j.read(arguments,2);c&&this.translate(c);var d=this._a,e=this._c;this._a+=b*this._b;this._c+=b*this._d;this._b+=a*d;this._d+=a*e;c&&this.translate(c.negate());return this},toString:function(){var a=n.formatNumber;return"[["+[a(this._a),a(this._b),a(this._tx)].join(", ")+"], ["+[a(this._c),a(this._d),a(this._ty)].join(", ")+"]]"},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,
this._ty]},concatenate:function(a){var b=this._a,c=this._b,d=this._c,e=this._d;this._a=a._a*b+a._c*c;this._b=a._b*b+a._d*c;this._tx+=a._tx*b+a._ty*c;this._c=a._a*d+a._c*e;this._d=a._b*d+a._d*e;this._ty+=a._tx*d+a._ty*e;return this},preConcatenate:function(a){var b=this._a,c=this._b,d=this._c,e=this._d,f=this._tx,i=this._ty;this._a=a._a*b+a._b*d;this._c=a._c*b+a._d*d;this._b=a._a*c+a._b*e;this._d=a._c*c+a._d*e;this._tx=a._a*f+a._b*i+a._tx;this._ty=a._c*f+a._d*i+a._ty;return this},transform:function(a,
b,c,d,e){return 5>arguments.length?this._transformPoint(j.read(arguments)):this._transformCoordinates(a,b,c,d,e)},_transformPoint:function(a,b,c){var d=a.x,a=a.y;b||(b=new j(j.dont));return b.set(d*this._a+a*this._b+this._tx,d*this._c+a*this._d+this._ty,c)},_transformCoordinates:function(a,b,c,d,e){for(var f=b,b=b+2*e;f<b;){var e=a[f++],i=a[f++];c[d++]=e*this._a+i*this._b+this._tx;c[d++]=e*this._c+i*this._d+this._ty}return c},_transformCorners:function(a){var b=a.x,c=a.y,d=b+a.width,a=c+a.height,
b=[b,c,d,c,d,a,b,a];return this._transformCoordinates(b,0,b,0,4)},_transformBounds:function(a){for(var a=this._transformCorners(a),b=a.slice(0,2),c=a.slice(0),d=2;8>d;d++){var e=a[d],f=d&1;e<b[f]?b[f]=e:e>c[f]&&(c[f]=e)}return u.create(b[0],b[1],c[0]-b[0],c[1]-b[1])},getDeterminant:function(){return this._a*this._d-this._b*this._c},getTranslation:function(){return new j(this._tx,this._ty)},getScaling:function(){var a=Math.sqrt(this._a*this._a+this._c*this._c),b=Math.sqrt(this._b*this._b+this._d*this._d);
return new j(0>this._a?-a:a,0>this._b?-b:b)},getRotation:function(){var a=-Math.atan2(this._b,this._d),b=Math.atan2(this._c,this._a);return Math.abs(a-b)<J.TOLERANCE?180*a/Math.PI:void 0},isIdentity:function(){return 1==this._a&&0==this._c&&0==this._b&&1==this._d&&0==this._tx&&0==this._ty},isInvertible:function(){var a=this.getDeterminant();return isFinite(a)&&0!=a&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},createInverse:function(){var a=this.getDeterminant();
return isFinite(a)&&0!=a&&isFinite(this._tx)&&isFinite(this._ty)?z.create(this._d/a,-this._c/a,-this._b/a,this._a/a,(this._b*this._ty-this._d*this._tx)/a,(this._c*this._tx-this._a*this._ty)/a):null},createShiftless:function(){return z.create(this._a,this._c,this._b,this._d,0,0)},setToScale:function(a,b){return this.set(a,0,0,b,0,0)},setToTranslation:function(a){a=j.read(arguments);return this.set(1,0,0,1,a.x,a.y)},setToShear:function(a,b){return this.set(1,b,a,1,0,0)},setToRotation:function(a,b){var b=
j.read(arguments,1),a=a*Math.PI/180,c=b.x,d=b.y,e=Math.cos(a),f=Math.sin(a);return this.set(e,f,-f,e,c-c*e+d*f,d-c*f-d*e)},applyToContext:function(a,b){a[b?"setTransform":"transform"](this._a,this._c,this._b,this._d,this._tx,this._ty);return this},statics:{create:function(a,b,c,d,e,f){return(new z(z.dont)).set(a,b,c,d,e,f)},getScaleInstance:function(a,b){var c=new z;return c.setToScale.apply(c,arguments)},getTranslateInstance:function(a){var b=new z;return b.setToTranslation.apply(b,arguments)},getShearInstance:function(a,
b,c){var d=new z;return d.setToShear.apply(d,arguments)},getRotateInstance:function(a,b){var c=new z;return c.setToRotation.apply(c,arguments)}}},new function(){return n.each({scaleX:"_a",scaleY:"_d",translateX:"_tx",translateY:"_ty",shearX:"_b",shearY:"_c"},function(a,b){b=n.capitalize(b);this["get"+b]=function(){return this[a]};this["set"+b]=function(b){this[a]=b}},{})}),ba=this.Line=n.extend({initialize:function(a,b,c){a=j.read(arguments,0,1);b=j.read(arguments,1,1);3==arguments.length?(this.point=
a,this.vector=b.subtract(a),this.infinite=c):(this.point=a,this.vector=b,this.infinite=!0)},intersect:function(a){var b=this.vector.cross(a.vector);if(Math.abs(b)<=J.EPSILON)return null;var c=a.point.subtract(this.point),d=c.cross(a.vector)/b,b=c.cross(this.vector)/b;return(this.infinite||0<=d&&1>=d)&&(a.infinite||0<=b&&1>=b)?this.point.add(this.vector.multiply(d)):null},getSide:function(a){var b=this.vector,a=a.subtract(this.point),c=a.cross(b);0==c&&(c=a.dot(b),0<c&&(c=a.subtract(b).dot(b),0>c&&
(c=0)));return 0>c?-1:0<c?1:0},getDistance:function(a){var b=this.vector.y/this.vector.x,b=Math.abs(a.y-b*a.x-(this.point.y-b*this.point.x))/Math.sqrt(b*b+1);return this.infinite?b:Math.min(b,a.getDistance(this.point),a.getDistance(this.point.add(this.vector)))}}),Aa=this.Project=ka.extend({_list:"projects",_reference:"project",initialize:function(){this.base(!0);this._currentStyle=new ha;this._selectedItems={};this._selectedItemCount=0;this.layers=[];this.symbols=[];this.activeLayer=new ia},_needsRedraw:function(){this._scope&&
this._scope._needsRedraw()},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(a){this._currentStyle.initialize(a)},getIndex:function(){return this._index},getSelectedItems:function(){var a=[];n.each(this._selectedItems,function(b){a.push(b)});return a},_updateSelection:function(a){a._selected?(this._selectedItemCount++,this._selectedItems[a.getId()]=a):(this._selectedItemCount--,delete this._selectedItems[a.getId()])},selectAll:function(){for(var a=0,b=this.layers.length;a<
b;a++)this.layers[a].setSelected(!0)},deselectAll:function(){for(var a in this._selectedItems)this._selectedItems[a].setSelected(!1)},hitTest:function(a,b){for(var b=HitResult.getOptions(a,b),a=b.point,c=this.layers.length-1;0<=c;c--){var d=this.layers[c].hitTest(a,b);if(d)return d}return null},draw:function(a){a.save();for(var b={offset:new j(0,0)},c=0,d=this.layers.length;c<d;c++)I.draw(this.layers[c],a,b);a.restore();if(0<this._selectedItemCount)a.save(),a.strokeWidth=1,a.strokeStyle=a.fillStyle=
"#009dec",b={selection:!0},n.each(this._selectedItems,function(c){c.draw(a,b)}),a.restore()}}),ma=this.Symbol=n.extend({initialize:function(a){this.project=paper.project;this.project.symbols.push(this);this.setDefinition(a);this._instances={}},_changed:function(a){n.each(this._instances,function(b){b._changed(a)})},getDefinition:function(){return this._definition},setDefinition:function(a){a._parentSymbol&&(a=a.clone());this._definition&&delete this._definition._parentSymbol;this._definition=a;a.remove();
a.setPosition(new j);a._parentSymbol=this;this._changed(N)},place:function(a){return new va(this,a)},clone:function(){return new ma(this._definition.clone())}});N=5;var I=this.Item=n.extend({initialize:function(){this._id=++I._id;this._project||paper.project.activeLayer.addChild(this);this._style=ha.create(this);this.setStyle(this._project.getCurrentStyle())},_changed:function(a){a&4&&(delete this._bounds,delete this._position);a&1&&this._project&&this._project._needsRedraw();this._parentSymbol&&
this._parentSymbol._changed(a)},getId:function(){return this._id},getName:function(){return this._name},setName:function(a){this._name&&this._removeFromNamed();this._name=a||void 0;if(a){var b=this._parent._children,c=this._parent._namedChildren;(c[a]=c[a]||[]).push(this);b[a]=this}this._changed(32)},getPosition:function(){var a=this._position||(this._position=this.getBounds().getCenter());return aa.create(this,"setPosition",a._x,a._y)},setPosition:function(a){this.translate(j.read(arguments).subtract(this.getPosition()))},
getStyle:function(){return this._style},setStyle:function(a){this._style.initialize(a)},statics:{_id:0}},new function(){return n.each(["locked","visible","blendMode","opacity","guide"],function(a){var b=n.capitalize(a),a="_"+a;this["get"+b]=function(){return this[a]};this["set"+b]=function(b){b!=this[a]&&(this[a]=b,this._changed("_locked"===a?32:33))}},{})},{_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._children)for(var a=0,b=this._children.length;a<
b;a++)if(this._children[a].isSelected())return!0;return this._selected},setSelected:function(a){if(this._children)for(var b=0,c=this._children.length;b<c;b++)this._children[b].setSelected(a);else if((a=!!a)!=this._selected)this._selected=a,this._project._updateSelection(this),this._changed(33)},_selected:!1,isFullySelected:function(){if(this._children&&this._selected){for(var a=0,b=this._children.length;a<b;a++)if(!this._children[a].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(a){if(this._children)for(var b=
0,c=this._children.length;b<c;b++)this._children[b].setFullySelected(a);this.setSelected(a)},isClipMask:function(){return this._clipMask},setClipMask:function(a){if(this._clipMask!=(a=!!a)){if(this._clipMask=a)this.setFillColor(null),this.setStrokeColor(null);this._changed(33);this._parent&&this._parent._changed(256)}},_clipMask:!1,getProject:function(){return this._project},_setProject:function(a){if(this._project!=a&&(this._project=a,this._children))for(var b=0,c=this._children.length;b<c;b++)this._children[b]._setProject(a)},
getParent:function(){return this._parent},getChildren:function(){return this._children},setChildren:function(a){this.removeChildren();this.addChildren(a)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||
null},getIndex:function(){return this._index},clone:function(){return this._clone(new this.constructor)},_clone:function(a){a.setStyle(this._style);if(this._children)for(var b=0,c=this._children.length;b<c;b++)a.addChild(this._children[b].clone());for(var d="_locked,_visible,_blendMode,_opacity,_clipMask,_guide".split(","),b=0,c=d.length;b<c;b++){var e=d[b];this.hasOwnProperty(e)&&(a[e]=this[e])}a.setSelected(this._selected);this._name&&a.setName(this._name);return a},copyTo:function(a){var b=this.clone();
a.layers?a.activeLayer.addChild(b):a.addChild(b);return b},rasterize:function(a){var b=this.getStrokeBounds(),a=(a||72)/72,c=O.getCanvas(b.getSize().multiply(a)),d=c.getContext("2d");(new z).scale(a).translate(-b.x,-b.y).applyToContext(d);this.draw(d,{});b=new ja(c);b.setPosition(this.getPosition());b.scale(1/a);return b},hitTest:function(a,b,c){b=HitResult.getOptions(a,b);a=b.point;if(!this._children&&!this.getRoughBounds(c).expand(b.tolerance)._containsPoint(a))return null;if((b.center||b.bounds)&&
(!(this instanceof ia)||this._parent)){var d=this.getBounds(),e=this,f="TopLeft,TopRight,BottomLeft,BottomRight,LeftCenter,TopCenter,RightCenter,BottomCenter".split(","),i,g=function(f,h){var g=d["get"+h]().transform(c);if(a.getDistance(g)<b.tolerance)return new HitResult(f,e,{name:n.hyphenate(h),point:g})};if(b.center&&(i=g("center","Center")))return i;if(b.bounds)for(var h=0;8>h;h++)if(i=g("bounds",f[h]))return i}return this._children||!(b.guides&&!this._guide||b.selected&&!this._selected)?this._hitTest(a,
b,c):null},_hitTest:function(a,b,c){if(this._children)for(var d=this._children.length-1;0<=d;d--){var e=this._children[d].hitTest(a,b,c);if(e)return e}},addChild:function(a){return this.insertChild(void 0,a)},insertChild:function(a,b){return this._children?(b._remove(!1,!0),n.splice(this._children,[b],a,0),b._parent=this,b._setProject(this._project),b._name&&b.setName(b._name),this._changed(3),!0):!1},addChildren:function(a){for(var b=0,c=a&&a.length;b<c;b++)this.insertChild(void 0,a[b])},insertChildren:function(a,
b){for(var c=0,d=b&&b.length;c<d;c++)this.insertChild(a,b[c])&&a++},insertAbove:function(a){return a._parent&&a._parent.insertChild(a._index+1,this)},insertBelow:function(a){return a._parent&&a._parent.insertChild(a._index-1,this)},appendTop:function(a){return this.addChild(a)},appendBottom:function(a){return this.insertChild(0,a)},moveAbove:function(a){return this.insertAbove(a)},moveBelow:function(a){return this.insertBelow(a)},_removeFromNamed:function(){var a=this._parent._children,b=this._parent._namedChildren,
c=this._name,d=b[c],e=d?d.indexOf(this):-1;-1!=e&&(a[c]==this&&delete a[c],d.splice(e,1),d.length?a[c]=d[d.length-1]:delete b[c])},_remove:function(a,b){return this._parent?(a&&this.setSelected(!1),this._name&&this._removeFromNamed(),n.splice(this._parent._children,null,this._index,1),b&&this._parent._changed(3),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},removeChildren:function(a,b){if(!this._children)return null;for(var a=a||0,b=n.pick(b,this._children.length),c=this._children.splice(a,
b-a),d=c.length-1;0<=d;d--)c[d]._remove(!0,!1);0<c.length&&this._changed(3);return c},reverseChildren:function(){if(this._children){this._children.reverse();for(var a=0,b=this._children.length;a<b;a++)this._children[a]._index=a;this._changed(3)}},isEditable:function(){for(var a=this;a;){if(!a._visible||a._locked)return!1;a=a._parent}return!0},_getOrder:function(a){function b(a){var b=[];do b.unshift(a);while(a=a._parent);return b}for(var c=b(this),a=b(a),d=0,e=Math.min(c.length,a.length);d<e;d++)if(c[d]!=
a[d])return c[d]._index<a[d]._index?1:-1;return 0},hasChildren:function(){return this._children&&0<this._children.length},isAbove:function(a){return-1==this._getOrder(a)},isBelow:function(a){return 1==this._getOrder(a)},isParent:function(a){return this._parent==a},isChild:function(a){return a&&a._parent==this},isDescendant:function(a){for(var b=this;b=b._parent;)if(b==a)return!0;return!1},isAncestor:function(a){return a?a.isDescendant(this):!1},isGroupedWith:function(a){for(var b=this._parent;b;){if(b._parent&&
(b instanceof na||b instanceof wa)&&a.isDescendant(b))return!0;b=b._parent}return!1},_getBounds:function(a,b,c){b=this._children;if(!b||0==b.length)return new u;for(var d=Infinity,e=-d,f=d,i=e,g=0,h=b.length;g<h;g++){var l=b[g];l._visible&&(l=l[a](c[0]),d=Math.min(l.x,d),f=Math.min(l.y,f),e=Math.max(l.x+l.width,e),i=Math.max(l.y+l.height,i))}c=u.create(d,f,e-d,i-f);return"getBounds"==a?this._createBounds(c):c},_createBounds:function(a){return la.create(this,"setBounds",a.x,a.y,a.width,a.height)},
getBounds:function(){return this._getBounds("getBounds","_bounds",arguments)},setBounds:function(a){var a=u.read(arguments),b=this.getBounds(),c=new z,d=a.getCenter();c.translate(d);if(a.width!=b.width||a.height!=b.height)c.scale(0!=b.width?a.width/b.width:1,0!=b.height?a.height/b.height:1);d=b.getCenter();c.translate(-d.x,-d.y);this.transform(c)},getStrokeBounds:function(){return this._getBounds("getStrokeBounds","_strokeBounds",arguments)},getHandleBounds:function(){return this._getBounds("getHandleBounds",
"_handleBounds",arguments)},getRoughBounds:function(){return this._getBounds("getRoughBounds","_roughBounds",arguments)},scale:function(a,b,c){if(2>arguments.length||"object"===typeof b)c=b,b=a;return this.transform((new z).scale(a,b,c||this.getPosition()))},translate:function(a){var b=new z;return this.transform(b.translate.apply(b,arguments))},rotate:function(a,b){return this.transform((new z).rotate(a,b||this.getPosition()))},shear:function(a,b,c){if(2>arguments.length||"object"===typeof b)c=b,
b=a;return this.transform((new z).shear(a,b,c||this.getPosition()))},transform:function(a,b){var c=this._bounds,d=this._position,e=this._children;this._transform&&(this._transform(a,b),this._changed(N));if(c&&0===a.getRotation()%90)this._bounds=this._createBounds(a._transformBounds(c)),this._position=this._bounds.getCenter();else if(d)this._position=a._transformPoint(d,d,!0);c=0;for(d=e&&e.length;c<d;c++)e[c].transform(a,b);return this},fitBounds:function(a,b){var a=u.read(arguments),c=this.getBounds(),
d=c.height/c.width,e=a.height/a.width,d=(b?d>e:d<e)?a.width/c.width:a.height/c.height;a.getCenter().subtract(c.getCenter());c=new u(new j,new r(c.width*d,c.height*d));c.setCenter(a.getCenter());this.setBounds(c)},toString:function(){return(this.constructor._name||"Item")+(this._name?" '"+this._name+"'":" @"+this._id)},statics:{drawSelectedBounds:function(a,b,c){a=c._transformCorners(a);b.beginPath();for(c=0;8>c;c++)b[0==c?"moveTo":"lineTo"](a[c],a[++c]);b.closePath();b.stroke();for(c=0;8>c;c++)b.beginPath(),
b.rect(a[c]-2,a[++c]-2,4,4),b.fill()},draw:function(a,b,c){if(a._visible&&0!=a._opacity){var d,e;if("normal"!==a._blendMode||1>a._opacity&&(!a._segments||a.getFillColor()&&a.getStrokeColor())){d=a.getStrokeBounds()||a.getBounds();if(!d.width||!d.height)return;var f=d.getTopLeft().floor();d=d.getSize().ceil().add(new r(1,1));d=O.getCanvas(d);e=b;b=d.getContext("2d");b.save();b.translate(-f.x,-f.y)}var i;if(f)i=c.offset,c.offset=f;a.draw(b,c);if(f)c.offset=i;if(d)b.restore(),"normal"!==a._blendMode?
(c=f.subtract(c.offset),Ba.process(a._blendMode,b,e,a._opacity,c)):(e.save(),e.globalAlpha=a._opacity,e.drawImage(d,f.x,f.y),e.restore()),O.returnCanvas(d)}}}},new function(){function a(a){var d="onMouse"+n.capitalize(a),e=paper.tool[d];if(!e||!e._installed)e={},e[d]=function(d){if("up"===a)b.drag={};var e=b[a],g;for(g in e){var h=e[g];h.remove();for(var l in b){var m=b[l];m!=e&&m[h.getId()]&&delete m[h.getId()]}}b[a]={};this.base&&this.base(d)},paper.tool.inject(e),paper.tool[d]._installed=!0}var b=
{down:{},drag:{},up:{},move:{}};return n.each(["down","drag","up","move"],function(a){this["removeOn"+n.capitalize(a)]=function(){var b={};b[a]=!0;return this.removeOn(b)}},{removeOn:function(c){for(var d in c)c[d]&&(b[d][this.getId()]=this,"drag"===d&&a("up"),a(d));return this}})}),na=this.Group=I.extend({initialize:function(a){this.base();this._children=[];this._namedChildren={};this.addChildren(!a||!Array.isArray(a)||"object"!==typeof a[0]?arguments:a)},_changed:function(a){I.prototype._changed.call(this,
a);a&258&&delete this._clipItem},_getClipItem:function(){if(void 0!==this._clipItem)return this._clipItem;for(var a=0,b=this._children.length;a<b;a++){var c=this._children[a];if(c._clipMask)return this._clipItem=c}return this._clipItem=null},isClipped:function(){return!!this._getClipItem()},setClipped:function(a){var b=this.getFirstChild();b&&b.setClipMask(a);return this},draw:function(a,b){var c=this._getClipItem();c&&I.draw(c,a,b);for(var d=0,e=this._children.length;d<e;d++){var f=this._children[d];
f!=c&&I.draw(f,a,b)}}}),ia=this.Layer=na.extend({initialize:function(a){this._project=paper.project;this._index=this._project.layers.push(this)-1;this.base.apply(this,arguments);this.activate()},_remove:function(a,b){if(this._parent)return this.base(a,b);return null!=this._index?(a&&this.setSelected(!1),n.splice(this._project.layers,null,this._index,1),this._project._needsRedraw(),!0):!1},getNextSibling:function(){return this._parent?this.base():this._project.layers[this._index+1]||null},getPreviousSibling:function(){return this._parent?
this.base():this._project.layers[this._index-1]||null},activate:function(){this._project.activeLayer=this}},new function(){function a(a){return function(c){return c instanceof ia&&!c._parent&&this._remove(!1,!0)?(n.splice(c._project.layers,[this],c._index+(a?1:-1),0),this._setProject(c._project),!0):this.base(c)}}return{insertAbove:a(!0),insertBelow:a(!1)}}),V=this.PlacedItem=I.extend({_transform:function(a){this._matrix.preConcatenate(a)},_changed:function(a){I.prototype._changed.call(this,a);a&
4&&(delete this._strokeBounds,delete this._handleBounds,delete this._roughBounds)},getMatrix:function(){return this._matrix},setMatrix:function(a){this._matrix=a.clone();this._changed(N)},getBounds:function(a){var b=void 0===a;if(b&&this._bounds)return this._bounds;a=this.getStrokeBounds(a);if(b)a=this._bounds=this._createBounds(a);return a},_getBounds:function(a,b,c){var d=c[0];if((c=void 0===d)&&this[b])return this[b];d=d?d.clone().concatenate(this._matrix):this._matrix;a=this._calculateBounds(a,
d);c&&(this[b]=a);return a}}),ja=this.Raster=V.extend({initialize:function(a){this.base();a.getContext?this.setCanvas(a):("string"===typeof a&&(a=document.getElementById(a)),this.setImage(a));this._matrix=new z},clone:function(){var a=this._image;a||(a=O.getCanvas(this._size),a.getContext("2d").drawImage(this._canvas,0,0));a=new ja(a);a._matrix=this._matrix.clone();return this._clone(a)},getSize:function(){return this._size},setSize:function(){var a=r.read(arguments),b=this.getImage();this.setCanvas(O.getCanvas(a));
this.getContext(!0).drawImage(b,0,0,a.width,a.height)},getWidth:function(){return this._size.width},getHeight:function(){return this._size.height},getPpi:function(){var a=this._matrix,b=(new j(0,0)).transform(a),c=(new j(1,0)).transform(a).subtract(b),a=(new j(0,1)).transform(a).subtract(b);return new r(72/c.getLength(),72/a.getLength())},getContext:function(a){if(!this._context)this._context=this.getCanvas().getContext("2d");a&&this._changed(129);return this._context},setContext:function(a){this._context=
a},getCanvas:function(){if(!this._canvas)this._canvas=O.getCanvas(this._size),this._image&&this.getContext(!0).drawImage(this._image,0,0);return this._canvas},setCanvas:function(a){this._canvas&&O.returnCanvas(this._canvas);this._canvas=a;this._size=new r(a.width,a.height);this._context=this._image=null;this._changed(N)},getImage:function(){return this._image||this.getCanvas()},setImage:function(a){this._canvas&&O.returnCanvas(this._canvas);this._image=a;this._size=new r(a.naturalWidth,a.naturalHeight);
this._context=this._canvas=null;this._changed(N)},getSubImage:function(a){var a=u.read(arguments),b=O.getCanvas(a.getSize());b.getContext("2d").drawImage(this.getCanvas(),a.x,a.y,b.width,b.height,0,0,b.width,b.height);return b},drawImage:function(a,b){b=j.read(arguments,1);this.getContext(!0).drawImage(a,b.x,b.y)},getAverageColor:function(a){a||(a=this.getBounds());var b,c;a instanceof oa?(c=a,b=a.getBounds()):a.width?b=new u(a):a.x&&(b=u.create(a.x-0.5,a.y-0.5,1,1));var a=Math.min(b.width,32),d=
Math.min(b.height,32),e=ja._sampleContext;e?e.clearRect(0,0,32,32):e=ja._sampleContext=O.getCanvas(new r(32)).getContext("2d");e.save();e.scale(a/b.width,d/b.height);e.translate(-b.x,-b.y);c&&c.draw(e,{clip:!0});this._matrix.applyToContext(e);e.drawImage(this._canvas||this._image,-this._size.width/2,-this._size.height/2);e.restore();b=e.getImageData(0.5,0.5,Math.ceil(a),Math.ceil(d)).data;c=[0,0,0];d=a=0;for(e=b.length;d<e;d+=4){var f=b[d+3],a=a+f,f=f/255;c[0]+=b[d]*f;c[1]+=b[d+1]*f;c[2]+=b[d+2]*
f}for(d=0;3>d;d++)c[d]/=a;return a?Q.read(c):null},getPixel:function(a){for(var a=j.read(arguments),b=this.getContext().getImageData(a.x,a.y,1,1).data,c=Array(4),d=0;4>d;d++)c[d]=b[d]/255;return T.read(c)},setPixel:function(a,b){var c=2==arguments.length,a=j.read(arguments,0,c?1:2),b=Q.read(arguments,c?1:2),c=this.getContext(!0),d=c.createImageData(1,1),e=b.getAlpha();d.data[0]=255*b.getRed();d.data[1]=255*b.getGreen();d.data[2]=255*b.getBlue();d.data[3]=null!=e?255*e:255;c.putImageData(d,a.x,a.y)},
createData:function(a){a=r.read(arguments);return this.getContext().createImageData(a.width,a.height)},getData:function(a){a=u.read(arguments);a.isEmpty()&&(a=new u(this.getSize()));return this.getContext().getImageData(a.x,a.y,a.width,a.height)},setData:function(a,b){b=j.read(arguments,1);this.getContext(!0).putImageData(a,b.x,b.y)},_calculateBounds:function(a,b){return b._transformBounds((new u(this._size)).setCenter(0,0))},getHandleBounds:function(a){return this.getStrokeBounds(a)},getRoughBounds:function(a){return this.getStrokeBounds(a)},
draw:function(a,b){if(b.selection){var c=(new u(this._size)).setCenter(0,0);I.drawSelectedBounds(c,a,this._matrix)}else a.save(),this._matrix.applyToContext(a),a.drawImage(this._canvas||this._image,-this._size.width/2,-this._size.height/2),a.restore()}}),va=this.PlacedSymbol=V.extend({initialize:function(a,b){this.base();this.setSymbol(a instanceof ma?a:new ma(a));this._matrix=void 0!==b?b instanceof z?b:(new z).translate(j.read(arguments,1)):new z},getSymbol:function(){return this._symbol},setSymbol:function(a){this._symbol&&
delete this._symbol._instances[this._id];this._symbol=a;a._instances[this._id]=this},clone:function(){return this._clone(new va(this.symbol,this._matrix.clone()))},_calculateBounds:function(a,b){return this.symbol._definition[a](b)},draw:function(a,b){b.selection?I.drawSelectedBounds(this.symbol._definition.getStrokeBounds(),a,this._matrix):(a.save(),this._matrix.applyToContext(a),I.draw(this.symbol.getDefinition(),a,b),a.restore())}});HitResult=n.extend({initialize:function(a,b,c){this.type=a;this.item=
b;c&&n.each(c,function(a,b){this[b]=a},this)},statics:{getOptions:function(a,b){return b&&b._merged?b:n.merge({point:j.read(arguments,0,1),type:null,tolerance:2,fill:!b,stroke:!b,segments:!b,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1,_merged:!0},b)}}});var t=this.Segment=n.extend({initialize:function(a,b,c,d,e,f){var i=arguments.length,g=pa.create,h,l,m;if(0!=i)1==i?a.point?(h=a.point,l=a.handleIn,m=a.handleOut):h=a:6>i?2==i&&void 0===b.x?h=[a,b]:(h=a,l=b,m=c):6==i&&(h=[a,b],l=[c,
d],m=[e,f]);g(this,"_point",h);g(this,"_handleIn",l);g(this,"_handleOut",m)},_changed:function(a){if(this._path){var b=this._path._curves&&this.getCurve(),c;b&&(b._changed(),(c=b[a==this._point||a==this._handleIn&&b._segment1==this?"getPrevious":"getNext"]())&&c._changed());this._path._changed(N)}},getPoint:function(){return this._point},setPoint:function(a){a=j.read(arguments);this._point.set(a.x,a.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(a){a=j.read(arguments);this._handleIn.set(a.x,
a.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(a){a=j.read(arguments);this._handleOut.set(a.x,a.y)},_isSelected:function(a){var b=this._selectionState;return a==this._point?!!(b&R):a==this._handleIn?!!(b&da):a==this._handleOut?!!(b&ea):!1},_setSelected:function(a,b){var c=this._path,b=!!b,d=this._selectionState||0,e=[!!(d&R),!!(d&da),!!(d&ea)];if(a==this._point){if(b)e[1]=e[2]=!1;else{var f=this.getPrevious(),i=this.getNext();e[1]=f&&(f._point.isSelected()||f._handleOut.isSelected());
e[2]=i&&(i._point.isSelected()||i._handleIn.isSelected())}e[0]=b}else f=a==this._handleIn?1:2,e[f]!=b&&(b&&(e[0]=!1),e[f]=b);this._selectionState=(e[0]?R:0)|(e[1]?da:0)|(e[2]?ea:0);c&&d!=this._selectionState&&c._updateSelection(this,d,this._selectionState)},isSelected:function(){return this._isSelected(this._point)},setSelected:function(a){this._setSelected(this._point,a)},getIndex:function(){return void 0!==this._index?this._index:null},getPath:function(){return this._path||null},getCurve:function(){if(this._path){var a=
this._index;!this._path._closed&&a==this._path._segments.length-1&&a--;return this._path.getCurves()[a]||null}return null},getNext:function(){var a=this._path&&this._path._segments;return a&&(a[this._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._segments;return a&&(a[this._index-1]||this._path._closed&&a[a.length-1])||null},reverse:function(){return new t(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):
!1},toString:function(){var a=["point: "+this._point];this._handleIn.isZero()||a.push("handleIn: "+this._handleIn);this._handleOut.isZero()||a.push("handleOut: "+this._handleOut);return"{ "+a.join(", ")+" }"},_transformCoordinates:function(a,b,c){var d=this._point,e=!c||!this._handleIn.isZero()?this._handleIn:null,f=!c||!this._handleOut.isZero()?this._handleOut:null,i=d._x,g=d._y,h=2;b[0]=i;b[1]=g;e&&(b[h++]=e._x+i,b[h++]=e._y+g);f&&(b[h++]=f._x+i,b[h++]=f._y+g);if(a)if(a._transformCoordinates(b,
0,b,0,h/2),i=b[0],g=b[1],c){d._x=i;d._y=g;h=2;if(e)e._x=b[h++]-i,e._y=b[h++]-g;if(f)f._x=b[h++]-i,f._y=b[h++]-g}else e||(b[h++]=i,b[h++]=g),f||(b[h++]=i,b[h++]=g)}}),pa=j.extend({set:function(a,b){this._x=a;this._y=b;this._owner._changed(this);return this},getX:function(){return this._x},setX:function(a){this._x=a;this._owner._changed(this)},getY:function(){return this._y},setY:function(a){this._y=a;this._owner._changed(this)},setSelected:function(a){this._owner._setSelected(this,a)},isSelected:function(){return this._owner._isSelected(this)},
statics:{create:function(a,b,c){var d=new pa(pa.dont),e,f,i;if(c)if(void 0!==(e=c[0]))f=c[1];else{if(void 0===(e=c.x))c=j.read(arguments,2,1),e=c.x;f=c.y;i=c.selected}else e=f=0;d._x=e;d._y=f;d._owner=a;a[b]=d;i&&d.setSelected(!0);return d}}});da=1;ea=2;R=4;var E=this.Curve=n.extend({initialize:function(a,b,c,d,e,f,i,g){var h=arguments.length;if(0==h)this._segment1=new t,this._segment2=new t;else if(1==h)this._segment1=new t(a.segment1),this._segment2=new t(a.segment2);else if(2==h)this._segment1=
new t(a),this._segment2=new t(b);else if(4==h)this._segment1=new t(a,null,b),this._segment2=new t(d,c,null);else if(8==h){var h=j.create(a,b),l=j.create(i,g);this._segment1=new t(h,null,j.create(c,d).subtract(h));this._segment2=new t(l,j.create(e,f).subtract(l),null)}},_changed:function(){delete this._length},getPoint1:function(){return this._segment1._point},setPoint1:function(a){a=j.read(arguments);this._segment1._point.set(a.x,a.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(a){a=
j.read(arguments);this._segment2._point.set(a.x,a.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(a){a=j.read(arguments);this._segment1._handleOut.set(a.x,a.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(a){a=j.read(arguments);this._segment2._handleIn.set(a.x,a.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},
getNext:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index-1]||this._path._closed&&a[a.length-1])||null},isSelected:function(){return this.getHandle1().isSelected()&&this.getHandle2().isSelected()},setSelected:function(a){this.getHandle1().setSelected(a);this.getHandle2().setSelected(a)},getValues:function(a){return E.getValues(this._segment1,
this._segment2,a)},getPoints:function(a){for(var a=this.getValues(a),b=[],c=0;8>c;c+=2)b.push(j.create(a[c],a[c+1]));return b},getLength:function(){var a=arguments[0],b=arguments[1];if((fullLength=0==arguments.length||0==a&&1==b)&&null!=this._length)return this._length;a=E.getLength(this.getValues(),a,b);if(fullLength)this._length=a;return a},getPart:function(a,b){return new E(E.getPart(this.getValues(),a,b))},isLinear:function(){return this._segment1._handleOut.isZero()&&this._segment2._handleIn.isZero()},
getParameterAt:function(a,b){return E.getParameterAt(this.getValues(),a,void 0!==b?b:0>a?1:0)},getPoint:function(a){return E.evaluate(this.getValues(),a,0)},getTangent:function(a){return E.evaluate(this.getValues(),a,1)},getNormal:function(a){return E.evaluate(this.getValues(),a,2)},getParameter:function(a){a=j.read(a);return E.getParameter(this.getValues(),a.x,a.y)},getCrossings:function(a,b,c){for(var d=this.getValues(b),e=E.solveCubic(d,1,a.y,c),f=0,i=0;i<e;i++){var g=c[i];0<=g&&1>g&&E.evaluate(d,
g,0).x>a.x&&!(g<J.TOLERANCE&&0<=E.evaluate(this.getPrevious().getValues(b),1,1).y*E.evaluate(d,g,1).y)&&f++}return f},reverse:function(){return new E(this._segment2.reverse(),this._segment1.reverse())},clone:function(){return new E(this._segment1,this._segment2)},toString:function(){var a=["point1: "+this._segment1._point];this._segment1._handleOut.isZero()||a.push("handle1: "+this._segment1._handleOut);this._segment2._handleIn.isZero()||a.push("handle2: "+this._segment2._handleIn);a.push("point2: "+
this._segment2._point);return"{ "+a.join(", ")+" }"},statics:{create:function(a,b,c){var d=new E(E.dont);d._path=a;d._segment1=b;d._segment2=c;return d},getValues:function(a,b,c){var d=a._point,a=a._handleOut,e=b._handleIn,b=b._point,d=[d._x,d._y,d._x+a._x,d._y+a._y,b._x+e._x,b._y+e._y,b._x,b._y];return c?c._transformCoordinates(d,0,d,0,4):d},evaluate:function(a,b,c){var d=a[0],e=a[1],f=a[2],i=a[3],g=a[4],h=a[5],l=a[6],a=a[7],m,p;if(0==c&&(0==b||1==b))m=0==b?d:l,p=0==b?e:a;else{var o=J.TOLERANCE;
b<o&&f==d&&i==e?b=o:b>1-o&&g==l&&h==a&&(b=1-o);o=3*(f-d);f=3*(g-f)-o;l=l-d-o-f;g=3*(i-e);i=3*(h-i)-g;h=a-e-g-i;switch(c){case 0:m=((l*b+f)*b+o)*b+d;p=((h*b+i)*b+g)*b+e;break;case 1:case 2:m=(3*l*b+2*f)*b+o,p=(3*h*b+2*i)*b+g}}return 2==c?new j(p,-m):new j(m,p)},subdivide:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],i=a[4],g=a[5],h=a[6],l=a[7];void 0===b&&(b=0.5);var m=1-b,p=m*c+b*e,o=m*d+b*f,j=m*e+b*i,q=m*f+b*g,i=m*i+b*h,g=m*g+b*l,f=m*p+b*j,e=m*o+b*q,j=m*j+b*i,q=m*q+b*g,s=m*f+b*j,m=m*e+b*q;return[[c,
d,p,o,f,e,s,m],[s,m,j,q,i,g,h,l]]},solveCubic:function(a,b,c,d){var e=a[b],f=a[b+2],i=3*(f-e),f=3*(a[b+4]-f)-i;return J.solveCubic(a[b+6]-e-i-f,f,i,e-c,d,J.TOLERANCE)},getParameter:function(a,b,c){for(var d=[],e=[],b=E.solveCubic(a,0,b,d),a=E.solveCubic(a,1,c,e),f,i,c=0;-1==b||c<b;)if(-1==b||0<=(f=d[c++])&&1>=f){for(var g=0;-1==a||g<a;)if(-1==a||0<=(i=e[g++])&&1>=i)if(-1==b?f=i:-1==a&&(i=f),Math.abs(f-i)<J.TOLERANCE)return 0.5*(f+i);if(-1==b)break}return null},getPart:function(a,b,c){0<b&&(a=E.subdivide(a,
b)[1]);1>c&&(a=E.subdivide(a,(c-b)/(1-b))[0]);return a},isFlatEnough:function(a){var b=a[0],c=a[1],d=a[6],e=a[7],f=c-e,i=d-b,c=b*e-d*c,b=f*a[2]+i*a[3]+c,a=f*a[4]+i*a[5]+c;return 0.0050>Math.abs((b*b+a*a)/(f*(f*f+i*i)))}}},new function(){function a(a){var b=a[0],e=a[1],f=a[2],i=a[3],g=a[4],h=a[5],l=9*(f-g)+3*(a[6]-b),m=6*(b+g)-12*f,p=3*(f-b),o=9*(i-h)+3*(a[7]-e),j=6*(e+h)-12*i,q=3*(i-e);return function(a){var b=(l*a+m)*a+p,a=(o*a+j)*a+q;return Math.sqrt(b*b+a*a)}}function b(a,b){return Math.max(2,
Math.min(16,Math.ceil(32*Math.abs(b-a))))}return{statics:!0,getLength:function(c,d,e){void 0===d&&(d=0);void 0===e&&(e=1);if(c[0]==c[2]&&c[1]==c[3]&&c[6]==c[4]&&c[7]==c[5]){var f=c[6]-c[0],c=c[7]-c[1];return(e-d)*Math.sqrt(f*f+c*c)}f=a(c);return J.integrate(f,d,e,b(d,e))},getParameterAt:function(c,d,e){if(0==d)return e;var f=0<d,i=f?e:0,g=f?1:e,d=Math.abs(d),h=a(c),c=J.integrate(h,i,g,b(i,g));if(d>=c)return f?g:i;var c=d/c,l=0;return J.findRoot(function(a){var c=b(e,a);l+=e<a?J.integrate(h,e,a,c):
-J.integrate(h,a,e,c);e=a;return l-d},h,f?i+c:g-c,i,g,16,J.TOLERANCE)}}},new function(){function a(d,i){for(var g=0,h=null,l=0,m=d.length;l<m;l++){var p=0>d[l].y?-1:1;null!=h&&p!=h&&g++;h=p}switch(g){case 0:return[];case 1:if(i>=b)return[0.5*(d[0].x+d[5].x)];for(var g=d.length-1,h=d[0].y-d[g].y,l=d[g].x-d[0].x,m=d[0].x*d[g].y-d[g].x*d[0].y,o=p=0,X=1;X<g;X++){var q=h*d[X].x+l*d[X].y+m,s=q*q;0>q&&s>o?o=s:s>p&&(p=s)}if(Math.abs((p+o)/(2*h*(h*h+l*l)))<c)return g=new ba(d[0],d[5],!0),[g.vector.getLength(!0)<
J.EPSILON?g.point.x:e.intersect(g).x]}g=[[]];h=[];l=[];for(m=0;5>=m;m++)g[0][m]=new j(d[m]);for(p=1;5>=p;p++){g[p]=[];for(m=0;m<=5-p;m++)g[p][m]=g[p-1][m].add(g[p-1][m+1]).multiply(0.5)}for(m=0;5>=m;m++)h[m]=g[m][0],l[m]=g[5-m][m];return a(h,i+1).concat(a(l,i+1))}var b=32,c=Math.pow(2,-b-1),d=[[1,0.6,0.3,0.1],[0.4,0.6,0.6,0.4],[0.1,0.3,0.6,1]],e=new ba(new j(0,0),new j(1,0));return{getNearestLocation:function(b,c){for(var e=this.getPoints(c),h=[],l=[],m=[],p=[],o=0;3>=o;o++)h[o]=e[o].subtract(b),
3>o&&(l[o]=e[o+1].subtract(e[o]).multiply(3));for(o=0;3>o;o++){m[o]=[];for(e=0;3>=e;e++)m[o][e]=l[o].dot(h[e])}for(o=0;5>=o;o++)p[o]=new j(o/5,0);for(k=0;5>=k;k++){l=Math.max(0,k-3+1);h=Math.min(k,3);for(o=l;o<=h;o++)l=k-o,p[k].y+=m[l][o]*d[l][o]}for(var m=a(p,0).concat([0,1]),p=Infinity,X,q,h=0;h<m.length;h++)l=this.getPoint(m[h]),o=b.getDistance(l,!0),o<p&&(p=o,X=m[h],q=l);return new CurveLocation(this,X,q,Math.sqrt(p))},getNearestPoint:function(a,b){return this.getNearestLocation(a,b).getPoint()}}});
CurveLocation=n.extend({initialize:function(a,b,c,d){this._curve=a;this._parameter=b;this._point=c;this._distance=d},getSegment:function(){if(!this._segment){var a=this._curve,b=this.getParameter();if(0==b)this._segment=a._segment1;else if(1==b)this._segment=a._segment2;else{if(null==b)return null;this._segment=a.getLength(0,b)<a.getLength(b,1)?a._segment1:a._segment2}}return this._segment},getCurve:function(){return this._curve},getPath:function(){return this._curve&&this._curve._path},getIndex:function(){return this._curve&&
this._curve.getIndex()},getOffset:function(){var a=this._curve&&this._curve._path;return a&&a._getOffset(this)},getCurveOffset:function(){var a=this.getParameter();return null!=a&&this._curve&&this._curve.getLength(0,a)},getParameter:function(){if(null==this._parameter&&this._curve&&this._point)this._parameter=this._curve.getParameterAt(this._point);return this._parameter},getPoint:function(){if(!this._point&&this._curve&&null!=this._parameter)this._point=this._curve.getPoint(this._parameter);return this._point},
getTangent:function(){var a=this.getParameter();return null!=a&&this._curve&&this._curve.getTangent(a)},getNormal:function(){var a=this.getParameter();return null!=a&&this._curve&&this._curve.getNormal(a)},getDistance:function(){return this._distance},toString:function(){var a=[],b=this.getPoint();b&&a.push("point: "+b);b=this.getIndex();null!=b&&a.push("index: "+b);b=this.getParameter();null!=b&&a.push("parameter: "+n.formatNumber(b));null!=this._distance&&a.push("distance: "+n.formatNumber(this._distance));
return"{ "+a.join(", ")+" }"}});var oa=this.PathItem=I.extend({}),M=this.Path=oa.extend({initialize:function(a){this.base();this._closed=!1;this._selectedSegmentState=0;this.setSegments(!a||!Array.isArray(a)||"object"!==typeof a[0]?arguments:a)},clone:function(){var a=this._clone(new M(this._segments));a._closed=this._closed;if(void 0!==this._clockwise)a._clockwise=this._clockwise;return a},_changed:function(a){I.prototype._changed.call(this,a);a&4?(delete this._strokeBounds,delete this._handleBounds,
delete this._roughBounds,delete this._length,delete this._clockwise):a&8&&delete this._strokeBounds},getSegments:function(){return this._segments},setSegments:function(a){this._segments?(this._selectedSegmentState=0,this._segments.length=0,this._curves&&delete this._curves):this._segments=[];this._add(t.readAll(a))},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){if(!this._curves){var a=this._segments,
b=a.length;!this._closed&&0<b&&b--;this._curves=Array(b);for(var c=0;c<b;c++)this._curves[c]=E.create(this,a[c],a[c+1]||a[0])}return this._curves},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var a=this.getCurves();return a[a.length-1]},getClosed:function(){return this._closed},setClosed:function(a){if(this._closed!=(a=!!a)){this._closed=a;if(this._curves){var b=this._segments.length,c;!a&&0<b&&b--;this._curves.length=b;a&&(this._curves[c=b-1]=E.create(this,this._segments[c],
this._segments[0]))}this._changed(N)}},_transform:function(a){if(!a.isIdentity()){for(var b=Array(6),c=0,d=this._segments.length;c<d;c++)this._segments[c]._transformCoordinates(a,b,!0);b=this.getFillColor();c=this.getStrokeColor();b&&b.transform&&b.transform(a);c&&c.transform&&c.transform(a)}},_add:function(a,b){for(var c=this._segments,d=this._curves,e=a.length,f=null==b,b=f?c.length:b,i=this.isFullySelected(),g=0;g<e;g++){var h=a[g];h._path&&(h=a[g]=new t(h));h._path=this;h._index=b+g;if(i)h._selectionState=
R;h._selectionState&&this._updateSelection(h,0,h._selectionState)}if(f)c.push.apply(c,a);else{c.splice.apply(c,[b,0].concat(a));g=b+e;for(f=c.length;g<f;g++)c[g]._index=g}if(d&&0<=--b&&(d.splice(b,0,E.create(this,c[b],c[b+1])),d=d[b+e]))d._segment1=c[b+e];this._changed(N);return a},add:function(a){return 1<arguments.length&&"number"!==typeof a?this._add(t.readAll(arguments)):this._add([t.read(arguments)])[0]},insert:function(a,b){return 2<arguments.length&&"number"!==typeof b?this._add(t.readAll(arguments,
1),a):this._add([t.read(arguments,1)],a)[0]},addSegment:function(a){return this._add([t.read(arguments)])[0]},insertSegment:function(a,b){return this._add([t.read(arguments,1)],a)[0]},addSegments:function(a){return this._add(t.readAll(a))},insertSegments:function(a,b){return this._add(t.readAll(b),a)},removeSegment:function(a){return this.removeSegments(a,a+1)[0]||null},removeSegments:function(a,b){var a=a||0,b=n.pick(b,this._segments.length),c=this._segments,d=this._curves,e=b>=c.length,f=c.splice(a,
b-a),i=f.length;if(!i)return f;for(var g=0;g<i;g++){var h=f[g];h._selectionState&&this._updateSelection(h,h._selectionState,0);f._index=f._path=void 0}g=a;for(h=c.length;g<h;g++)c[g]._index=g;if(d){d.splice(a,i);if(i=d[a-1])i._segment2=c[a];if(i=d[a])i._segment1=c[a];if(e&&this._closed&&(i=d[d.length-1]))i._segment2=c[0]}this._changed(N);return f},isFullySelected:function(){return this._selected&&this._selectedSegmentState==this._segments.length*R},setFullySelected:function(a){var b=this._segments.length;
this._selectedSegmentState=a?b*R:0;for(var c=0;c<b;c++)this._segments[c]._selectionState=a?R:0;this.setSelected(a)},_updateSelection:function(a,b,c){a._selectionState=c;0<(this._selectedSegmentState+=c-b)&&this.setSelected(!0)},flatten:function(a){for(var b=new xa(this),c=0,a=b.length/Math.ceil(b.length/a),d=b.length+(this._closed?-a:a)/2,e=[];c<=d;)e.push(new t(b.evaluate(c,0))),c+=a;this.setSegments(e)},simplify:function(a){2<this._segments.length&&this.setSegments((new Ca(this,a||2.5)).fit())},
isClockwise:function(){function a(a,e){void 0!==c&&(b+=(c-a)*(e+d));c=a;d=e}if(void 0!==this._clockwise)return this._clockwise;for(var b=0,c,d,e=0,f=this._segments.length;e<f;e++){var i=this._segments[e],g=this._segments[e+1<f?e+1:0],h=i._point,i=i._handleOut,l=g._handleIn,g=g._point;a(h._x,h._y);a(h._x+i._x,h._y+i._y);a(g._x+l._x,g._y+l._y);a(g._x,g._y)}return 0<b},setClockwise:function(a){if(this.isClockwise()!=(a=!!a))this.reverse(),this._clockwise=a},reverse:function(){this._segments.reverse();
for(var a=0,b=this._segments.length;a<b;a++){var c=this._segments[a],d=c._handleIn;c._handleIn=c._handleOut;c._handleOut=d}if(void 0!==this._clockwise)this._clockwise=!this._clockwise},join:function(a){if(a){var b=a._segments,c=this.getLastSegment(),d=a.getLastSegment();c._point.equals(d._point)&&a.reverse();d=a.getFirstSegment();if(c._point.equals(d._point))c.setHandleOut(d._handleOut),this._add(b.slice(1));else{var e=this.getFirstSegment();e._point.equals(d._point)&&a.reverse();d=a.getLastSegment();
e._point.equals(d._point)?(e.setHandleIn(d._handleIn),this._add(b.slice(0,b.length-1),0)):this._add(b.slice(0))}a.remove();e=this.getFirstSegment();c=this.getLastSegment();c._point.equals(e._point)&&(e.setHandleIn(c._handleIn),c.remove(),this.setClosed(!0));this._changed(N);return!0}return!1},getLength:function(){if(null==this._length)for(var a=this.getCurves(),b=this._length=0,c=a.length;b<c;b++)this._length+=a[b].getLength();return this._length},_getOffset:function(a){var b=a&&a.getIndex();if(null!=
b){for(var c=this.getCurves(),d=0,e=0;e<b;e++)d+=c[e].getLength();return d+c[b].getLength(0,a.getParameter())}return null},getLocation:function(a){for(var b=this.getCurves(),c=0,d=b.length;c<d;c++){var e=b[c],f=e.getParameter(a);if(null!=f)return new CurveLocation(e,f)}return null},getLocationAt:function(a,b){var c=this.getCurves(),d=0;if(b)return d=~~a,new CurveLocation(c[d],a-d);for(var e=0,f=c.length;e<f;e++){var i=d,g=c[e],d=d+g.getLength();if(d>=a)return new CurveLocation(g,g.getParameterAt(a-
i))}return a<=this.getLength()?new CurveLocation(c[c.length-1],1):null},getPointAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getPoint()},getTangentAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getTangent()},getNormalAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getNormal()},getNearestLocation:function(a,b){for(var c=this.getCurves(),d=Infinity,e=null,f=0,i=c.length;f<i;f++){var g=c[f].getNearestLocation(a,b);if(g._distance<d)d=g._distance,e=g}return e},getNearestPoint:function(a,
b){return this.getNearestLocation(a,b).getPoint()},contains:function(a,b){a=j.read(arguments);if(!this._closed||!this.getRoughBounds(b)._containsPoint(a))return!1;for(var c=this.getCurves(),d=0,e=[],f=0,i=c.length;f<i;f++)d+=c[f].getCrossings(a,b,e);return 1==(d&1)},_hitTest:function(a,b,c){function d(d,f){d._transformCoordinates(c,h);for(var g=f||b.segments?0:2,i=!f&&b.handles?6:2;g<i;g+=2)if(a.getDistance(h[g],h[g+1])<e)return new HitResult(0==g?"segment":"handle-"+(2==g?"in":"out"),l,{segment:d})}
var e=b.tolerance||0,f=(b.stroke?this.getStrokeWidth()/2:0)+e,i,g,h=[],l=this;if(b.ends&&!b.segments&&!this._closed){if(g=d(this.getFirstSegment(),!0)||d(this.getLastSegment(),!0))return g}else if(b.segments||b.handles)for(var m=0,p=this._segments.length;m<p;m++)if(g=d(this._segments[m]))return g;b.stroke&&0<f&&(i=this.getNearestLocation(a,c));if(!(i&&i._distance<=f)&&b.fill&&this.getFillColor()&&this.contains(a,c))return new HitResult("fill",this);!i&&b.stroke&&0<f&&(i=this.getNearestLocation(a,
c));if(i&&i._distance<=f)return b.stroke?new HitResult("stroke",this,{location:i}):new HitResult("fill",this)}},new function(){function a(a,b,e){if(!e.isZero()){var f=b._x+e._x,e=b._y+e._y;a.beginPath();a.moveTo(b._x,b._y);a.lineTo(f,e);a.stroke();a.beginPath();a.arc(f,e,1.75,0,2*Math.PI,!0);a.fill()}}function b(a,b){function e(b){var b=f[b],d=b._point,e=d._x,d=d._y,i=b._handleIn;g?i.isZero()&&g.isZero()?a.lineTo(e,d):a.bezierCurveTo(h,l,i._x+e,i._y+d,e,d):a.moveTo(e,d);g=b._handleOut;h=g._x+e;l=
g._y+d}for(var f=b._segments,i=f.length,g,h,l,m=0;m<i;m++)e(m);b._closed&&1<i&&e(0)}return{draw:function(c,d){d.compound||c.beginPath();var e=this.getFillColor(),f=this.getStrokeColor(),i=this.getDashArray()||[],g=!!i.length;(d.compound||d.selection||this._clipMask||e||f&&!g)&&b(c,this);if(d.selection){c.stroke();i=this._segments;e=0;for(f=i.length;e<f;e++){var g=i[e],h=g._point,l=g._selectionState,m=l&R;(m||l&da)&&a(c,h,g._handleIn);(m||l&ea)&&a(c,h,g._handleOut);c.save();c.beginPath();c.rect(h._x-
2,h._y-2,4,4);c.fill();if(!m)c.beginPath(),c.rect(h._x-1,h._y-1,2,2),c.fillStyle="#ffffff",c.fill(),c.restore()}}else if(this._clipMask)c.clip();else if(!d.compound&&(e||f)){c.save();this._setStyles(c);if(!e||!f)c.globalAlpha=this._opacity;if(e)c.fillStyle=e.getCanvasStyle(c),c.fill();if(f){c.strokeStyle=f.getCanvasStyle(c);if(g){c.beginPath();f=this.getDashOffset();e=new xa(this);for(h=0;f<e.length;)g=f+i[h++%i.length],e.drawPart(c,f,g),f=g+i[h++%i.length]}c.stroke()}c.restore()}}}},new function(){function a(a){var b=
a.length,e=[],f=[],i=2;e[0]=a[0]/i;for(var g=1;g<b;g++)f[g]=1/i,i=(g<b-1?4:2)-f[g],e[g]=(a[g]-e[g-1])/i;for(g=1;g<b;g++)e[b-g-1]-=f[b-g]*e[b-g];return e}var b={getStrokeWidth:"lineWidth",getStrokeJoin:"lineJoin",getStrokeCap:"lineCap",getMiterLimit:"miterLimit"};return{_setStyles:function(a){for(var d in b){var e=this._style[d]();e&&(a[b[d]]=e)}},smooth:function(){var b=this._segments,d=b.length,e=d,f;if(!(2>=d)){this._closed?(f=Math.min(d,4),e+=2*Math.min(d,f)):f=0;for(var i=[],g=0;g<d;g++)i[g+f]=
b[g]._point;if(this._closed)for(g=0;g<f;g++)i[g]=b[g+d-f]._point,i[g+d+f]=b[g]._point;else e--;for(var h=[],g=1;g<e-1;g++)h[g]=4*i[g]._x+2*i[g+1]._x;h[0]=i[0]._x+2*i[1]._x;h[e-1]=3*i[e-1]._x;for(var l=a(h),g=1;g<e-1;g++)h[g]=4*i[g]._y+2*i[g+1]._y;h[0]=i[0]._y+2*i[1]._y;h[e-1]=3*i[e-1]._y;h=a(h);if(this._closed){for(g=0;g<f;g++,d++){var m=g/f,p=1-m;l[d]=l[g]*m+l[d]*p;h[d]=h[g]*m+h[d]*p;var o=g+f,X=d+f;l[X]=l[o]*p+l[X]*m;h[X]=h[o]*p+h[X]*m}e--}d=null;for(g=f;g<=e-f;g++)m=b[g-f],d&&m.setHandleIn(d.subtract(m._point)),
g<e&&(m.setHandleOut((new j(l[g],h[g])).subtract(m._point)),d=g<e-1?new j(2*i[g+1]._x-l[g+1],2*i[g+1]._y-h[g+1]):new j((i[e]._x+l[e-1])/2,(i[e]._y+h[e-1])/2));this._closed&&d&&(m=this._segments[0],m.setHandleIn(d.subtract(m._point)))}}}},new function(){function a(a){a=a._segments;if(0==a.length)throw Error("Use a moveTo() command first");return a[a.length-1]}return{moveTo:function(a){this._segments.length||this._add([new t(j.read(arguments))])},moveBy:function(){throw Error("moveBy() is unsupported on Path items.");
},lineTo:function(a){this._add([new t(j.read(arguments))])},cubicCurveTo:function(b,c,d){var b=j.read(arguments,0,1),c=j.read(arguments,1,1),d=j.read(arguments,2,1),e=a(this);e.setHandleOut(b.subtract(e._point));this._add([new t(d,c.subtract(d))])},quadraticCurveTo:function(b,c){var b=j.read(arguments,0,1),c=j.read(arguments,1,1),d=a(this)._point;this.cubicCurveTo(b.add(d.subtract(b).multiply(1/3)),b.add(c.subtract(b).multiply(1/3)),c)},curveTo:function(b,c,d){var b=j.read(arguments,0,1),c=j.read(arguments,
1,1),e=n.pick(d,0.5),f=1-e,i=a(this)._point,f=b.subtract(i.multiply(f*f)).subtract(c.multiply(e*e)).divide(2*e*f);if(f.isNaN())throw Error("Cannot put a curve through points with parameter = "+e);this.quadraticCurveTo(f,c)},arcTo:function(b,c){var d=a(this),e=d._point,f;void 0===c&&(c=!0);if("boolean"===typeof c){var b=j.read(arguments,0,1),i=e.add(b).divide(2);f=i.add(i.subtract(e).rotate(c?-90:90))}else f=j.read(arguments,0,1),b=j.read(arguments,1,1);var i=new ba(e.add(f).divide(2),f.subtract(e).rotate(90)),
g=new ba(f.add(b).divide(2),b.subtract(f).rotate(90)),i=i.intersect(g),h=new ba(e,b,!0),g=h.getSide(f);if(!i){if(!g)return this.lineTo(b);throw Error("Cannot put an arc through the given points: "+[e,f,b]);}e=e.subtract(i);e.getLength();f=e.getDirectedAngle(b.subtract(i));h=h.getSide(i);0==h?f=g*Math.abs(f):g==h&&(f-=360*(0>f?-1:1));g=Math.abs(f);g=360<=g?4:Math.ceil(g/90);f/=g;for(var h=f*Math.PI/360,h=4/3*Math.sin(h)/(1+Math.cos(h)),l=[],m=0;m<=g;m++){var p=m<g?i.add(e):b,o=m<g?e.rotate(90).multiply(h):
null;0==m?d.setHandleOut(o):l.push(new t(p,e.rotate(-90).multiply(h),o));e=e.rotate(f)}this._add(l)},lineBy:function(b){b=j.read(arguments);this.lineTo(a(this)._point.add(b))},curveBy:function(b,c,d){var b=j.read(b),c=j.read(c),e=a(this)._point;this.curveTo(e.add(b),e.add(c),d)},arcBy:function(b,c){var b=j.read(b),c=j.read(c),d=a(this)._point;this.arcBy(d.add(b),d.add(c))},closePath:function(){this.setClosed(!0)}}},new function(){function a(a,b,e){function f(a){a._transformCoordinates(b,h,!1);for(var c=
0;2>c;c++){var f=l[c],g=l[c+4],i=h[c+2],q=h[c],a=function(a,b){var d=0;if(null==a)var h=1-b,a=h*h*h*f+3*h*h*b*g+3*h*b*b*i+b*b*b*q,d=e?e[c]:0;h=a-d;d=a+d;h<m[c]&&(m[c]=h);d>p[c]&&(p[c]=d)};a(q,null);var s=3*(g-i)-f+q,n=2*(f+i)-4*g,t=g-f;if(0==s)0!=n&&(n=-t/n,o<n&&n<j&&a(null,n));else if(t=n*n-4*s*t,!(0>t)){var t=Math.sqrt(t),r=-0.5/s,s=(n-t)*r,n=(n+t)*r;o<s&&s<j&&a(null,s);o<n&&n<j&&a(null,n)}}a=l;l=h;h=a}var i=a._segments,g=i[0];if(!g)return null;var h=Array(6),l=Array(6);b&&b.isIdentity()&&(b=null);
g._transformCoordinates(b,l,!1);for(var m=l.slice(0,2),p=m.slice(0),o=J.TOLERANCE,j=1-o,q=1,s=i.length;q<s;q++)f(i[q]);a._closed&&f(g);return u.create(m[0],m[1],p[0]-m[0],p[1]-m[1])}function b(a,b){if(!b)return[a,a];var e=b.createShiftless(),f=e.transform(new j(a,0)),i=e.transform(new j(0,a)),e=f.getAngleInRadians(),f=f.getLength(),i=i.getLength(),g=-Math.atan(i*Math.tan(e)),h=+Math.atan(i/Math.tan(e)),g=f*Math.cos(g)*Math.cos(e)-i*Math.sin(g)*Math.sin(e),e=i*Math.sin(h)*Math.cos(e)+f*Math.cos(h)*
Math.sin(e);return[Math.abs(g),Math.abs(e)]}return{getBounds:function(b){var d=void 0===b;if(d&&this._bounds)return this._bounds;b=this._createBounds(a(this,b));if(d)this._bounds=b;return b},getStrokeBounds:function(){function c(a){s=s.include(g?g.transform(a):a)}function d(a,b){var d=a.getPoint(b),e=a.getNormal(b).normalize(l);c(d.add(e));c(d.subtract(e))}function e(a,b){if("round"===b||!a._handleIn.isZero()&&!a._handleOut.isZero())s=s.unite(y.setCenter(g?g.transform(a._point):a._point));else if("bevel"==
b){var h=a.getCurve();d(h,0);d(h.getPrevious(),1)}else if("miter"==b){var f=a.getCurve(),i=f.getPrevious(),h=f.getPoint(0),i=i.getNormal(1).normalize(l),f=f.getNormal(0).normalize(l),i=new ba(h.subtract(i),new j(-i.y,i.x)),f=new ba(h.subtract(f),new j(-f.y,f.x)),f=i.intersect(f);!f||h.getDistance(f)>n?e(a,"bevel"):c(f)}}function f(a,b,d){switch(b){case "round":return e(a,b);case "butt":case "square":var h=a.getCurve(),a=h.getPoint(d),d=h.getNormal(d).normalize(l);"square"===b&&(a=a.add(d.y,-d.x));
c(a.add(d));c(a.subtract(d))}}if(!this._style._strokeColor||!this._style._strokeWidth)return this.getBounds.apply(this,arguments);var i=void 0===arguments[0];if(i&&this._strokeBounds)return this._strokeBounds;for(var g=arguments[0],h=this.getStrokeWidth(),l=h/2,m=b(l,g),p=this.getStrokeJoin(),o=this.getStrokeCap(),n=this.getMiterLimit()*h/2,h=this._segments,q=h.length,s=a(this,g,b(l)),y=new u((new r(m)).multiply(2)),m=1,v=q-(this._closed?0:1);m<v;m++)e(h[m],p);this._closed?e(h[0],p):(f(h[0],o,0),
f(h[q-1],o,1));if(i)this._strokeBounds=s;return s},getHandleBounds:function(a,b,e){var f=void 0===a;if(f&&this._handleBounds)return this._handleBounds;for(var i=Array(6),b=b/2||0,e=e/2||0,g=Infinity,h=-g,l=g,m=h,p=0,o=this._segments.length;p<o;p++){this._segments[p]._transformCoordinates(a,i,!1);for(var j=0;6>j;j+=2){var q=0==j?e:b,s=i[j],n=i[j+1],v=s-q,s=s+q,t=n-q,q=n+q;v<g&&(g=v);s>h&&(h=s);t<l&&(l=t);q>m&&(m=q)}}a=u.create(g,l,h-g,m-l);if(f)this._handleBounds=a;return a},getRoughBounds:function(a){var b=
void 0===a;if(b&&this._roughBounds)return this._roughBounds;a=this.getHandleBounds(a,this.strokeWidth,"miter"==this.getStrokeJoin()?this.strokeWidth*this.getMiterLimit():this.strokeWidth);if(b)this._roughBounds=a;return a}}});M.inject({statics:new function(){var a=2/3*(Math.sqrt(2)-1),b=[new t([0,0.5],[0,a],[0,-a]),new t([0.5,0],[-a,0],[a,0]),new t([1,0.5],[0,-a],[0,a]),new t([0.5,1],[a,0],[-a,0])];return{Line:function(){var a=Math.floor(arguments.length/2);return new M(t.read(arguments,0,a),t.read(arguments,
a,a))},Rectangle:function(a){for(var a=u.read(arguments),b=new M,e=["getBottomLeft","getTopLeft","getTopRight","getBottomRight"],f=Array(4),i=0;4>i;i++)f[i]=new t(a[e[i]]());b._add(f);b._closed=!0;return b},RoundRectangle:function(b,d){2==arguments.length?(b=u.read(arguments,0,1),d=r.read(arguments,1,1)):6==arguments.length&&(b=u.read(arguments,0,4),d=r.read(arguments,4,2));var d=r.min(d,b.getSize().divide(2)),e=new M,f=d.multiply(2*a),i=b.getBottomLeft(),g=b.getTopLeft(),h=b.getTopRight(),l=b.getBottomRight();
e._add([new t(i.add(d.width,0),null,[-f.width,0]),new t(i.subtract(0,d.height),[0,f.height],null),new t(g.add(0,d.height),null,[0,-f.height]),new t(g.add(d.width,0),[-f.width,0],null),new t(h.subtract(d.width,0),null,[f.width,0]),new t(h.add(0,d.height),[0,-f.height],null),new t(l.subtract(0,d.height),null,[0,f.height]),new t(l.subtract(d.width,0),[f.width,0],null)]);e._closed=!0;return e},Oval:function(a){for(var a=u.read(arguments),d=new M,e=a.getTopLeft(),f=new r(a.width,a.height),i=Array(4),g=
0;4>g;g++){var h=b[g];i[g]=new t(h._point.multiply(f).add(e),h._handleIn.multiply(f),h._handleOut.multiply(f))}d._add(i);d._closed=!0;return d},Circle:function(a,b){3==arguments.length?(a=j.read(arguments,0,2),b=arguments[2]):a=j.read(arguments,0,1);return M.Oval(new u(a.subtract(b),new r(2*b,2*b)))},Arc:function(a,b,e){var f=new M;f.moveTo(a);f.arcTo(b,e);return f},RegularPolygon:function(a,b,e){for(var a=j.read(arguments,0,1),f=new M,i=360/b,g=!(b%3),h=new j(0,g?-e:e),g=g?-1:0.5,l=Array(b),m=0;m<
b;m++)l[m]=new t(a.add(h.rotate((m+g)*i)));f._add(l);f._closed=!0;return f},Star:function(a,b,e,f){for(var a=j.read(arguments,0,1),b=2*b,i=new M,g=360/b,h=new j(0,-1),l=Array(b),m=0;m<b;m++)l[m]=new t(a.add(h.rotate(g*m).multiply(m%2?f:e)));i._add(l);i._closed=!0;return i}}}});var wa=this.CompoundPath=oa.extend({initialize:function(a){this.base();this._children=[];this._namedChildren={};this.addChildren(!a||!Array.isArray(a)||"object"!==typeof a[0]?arguments:a)},insertChild:function(a,b){this.base(a,
b);void 0===b._clockwise&&b.setClockwise(0==b._index)},simplify:function(){if(1==this._children.length){var a=this._children[0];a.insertAbove(this);this.remove();return a}return this},smooth:function(){for(var a=0,b=this._children.length;a<b;a++)this._children[a].smooth()},draw:function(a,b){var c=this._children.length;if(0!=c){var d=this._children[0];a.beginPath();b.compound=!0;for(var e=0;e<c;e++)I.draw(this._children[e],a,b);d._setStyles(a);c=d.getFillColor();d=d.getStrokeColor();if(c)a.fillStyle=
c.getCanvasStyle(a),a.fill();if(d)a.strokeStyle=d.getCanvasStyle(a),a.stroke();b.compound=!1}}},new function(){function a(a){if(!a._children.length)throw Error("Use a moveTo() command first");return a._children[a._children.length-1]}var b={moveTo:function(a){var b=new M;this.addChild(b);b.moveTo.apply(b,arguments)},moveBy:function(b){this.moveTo(a(this).getLastSegment()._point.add(j.read(arguments)))},closePath:function(){a(this).setClosed(!0)}};n.each("lineTo,cubicCurveTo,quadraticCurveTo,curveTo,arcTo,lineBy,curveBy,arcBy".split(","),
function(c){b[c]=function(){var b=a(this);b[c].apply(b,arguments)}});return b}),xa=n.extend({initialize:function(a){function b(a,b){var c=E.getValues(a,b);f.curves.push(c);f._computeParts(c,a._index,0,1)}this.curves=[];this.parts=[];this.index=this.length=0;for(var c=a._segments,d=c[0],e,f=this,i=1,g=c.length;i<g;i++)e=c[i],b(d,e),d=e;a._closed&&b(e,c[0])},_computeParts:function(a,b,c,d){if(0.03125<d-c&&!E.isFlatEnough(a)){var a=E.subdivide(a),e=(c+d)/2;this._computeParts(a[0],b,c,e);this._computeParts(a[1],
b,e,d)}else c=a[6]-a[0],a=a[7]-a[1],c=Math.sqrt(c*c+a*a),c>J.TOLERANCE&&(this.length+=c,this.parts.push({offset:this.length,value:d,index:b}))},getParameterAt:function(a){for(var b,c=this.index;!(b=c,0==c||this.parts[--c].offset<a););for(var d=this.parts.length;b<d;b++)if(c=this.parts[b],c.offset>=a)return this.index=b,b=(d=this.parts[b-1])&&d.index==c.index?d.value:0,d=d?d.offset:0,{value:b+(c.value-b)*(a-d)/(c.offset-d),index:c.index};c=this.parts[this.parts.length-1];return{value:1,index:c.index}},
evaluate:function(a,b){var c=this.getParameterAt(a);return E.evaluate(this.curves[c.index],c.value,b)},drawPart:function(a,b,c){for(var b=this.getParameterAt(b),c=this.getParameterAt(c),d=b.index;d<=c.index;d++){var e=E.getPart(this.curves[d],d==b.index?b.value:0,d==c.index?c.value:1);d==b.index&&a.moveTo(e[0],e[1]);a.bezierCurveTo.apply(a,e.slice(2))}}}),Ca=n.extend({initialize:function(a,b){this.points=[];for(var c=a._segments,d,e=0,f=c.length;e<f;e++){var i=c[e].point.clone();if(!d||!d.equals(i))this.points.push(i),
d=i}this.error=b},fit:function(){this.segments=[new t(this.points[0])];this.fitCubic(0,this.points.length-1,this.points[1].subtract(this.points[0]).normalize(),this.points[this.points.length-2].subtract(this.points[this.points.length-1]).normalize());return this.segments},fitCubic:function(a,b,c,d){if(1==b-a){var a=this.points[a],b=this.points[b],e=a.getDistance(b)/3;this.addCurve([a,a.add(c.normalize(e)),b.add(d.normalize(e)),b])}else{for(var f=this.chordLengthParameterize(a,b),i=Math.max(this.error,
this.error*this.error),g=0;4>=g;g++){var h=this.generateBezier(a,b,f,c,d),l=this.findMaxError(a,b,h,f);if(l.error<this.error){this.addCurve(h);return}e=l.index;if(l.error>=i)break;this.reparameterize(a,b,f,h);i=l.error}f=this.points[e-1].subtract(this.points[e]);i=this.points[e].subtract(this.points[e+1]);f=f.add(i).divide(2).normalize();this.fitCubic(a,e,c,f);this.fitCubic(e,b,f.negate(),d)}},addCurve:function(a){this.segments[this.segments.length-1].setHandleOut(a[1].subtract(a[0]));this.segments.push(new t(a[3],
a[2].subtract(a[3])))},generateBezier:function(a,b,c,d,e){var w;for(var f=J.EPSILON,i=this.points[a],g=this.points[b],h=[[0,0],[0,0]],l=[0,0],m=0,b=b-a+1;m<b;m++){var p=c[m],o=1-p,j=3*p*o,q=o*o*o,o=j*o,j=j*p,s=p*p*p,p=d.normalize(o),n=e.normalize(j),q=this.points[a+m].subtract(i.multiply(q+o)).subtract(g.multiply(j+s));h[0][0]+=p.dot(p);h[0][1]+=p.dot(n);h[1][0]=h[0][1];h[1][1]+=n.dot(n);l[0]+=p.dot(q);l[1]+=n.dot(q)}var a=h[0][0]*h[1][1]-h[1][0]*h[0][1],v;Math.abs(a)>f?(v=h[0][0]*l[1]-h[1][0]*l[0],
l=(l[0]*h[1][1]-l[1]*h[0][1])/a,v/=a):(a=h[0][0]+h[0][1],h=h[1][0]+h[1][1],w=Math.abs(a)>f?v=l[0]/a:Math.abs(a)>f?v=l[1]/h:v=0,l=w);h=g.getDistance(i);f*=h;if(l<f||v<f)l=v=h/3;return[i,i.add(d.normalize(l)),g.add(e.normalize(v)),g]},reparameterize:function(a,b,c,d){for(var e=a;e<=b;e++)c[e-a]=this.findRoot(d,this.points[e],c[e-a])},findRoot:function(a,b,c){for(var d=[],e=[],f=0;2>=f;f++)d[f]=a[f+1].subtract(a[f]).multiply(3);for(f=0;1>=f;f++)e[f]=d[f+1].subtract(d[f]).multiply(2);a=this.evaluate(3,
a,c);d=this.evaluate(2,d,c);e=this.evaluate(1,e,c);b=a.subtract(b);e=d.dot(d)+b.dot(e);return Math.abs(e)<J.TOLERANCE?c:c-b.dot(d)/e},evaluate:function(a,b,c){for(var b=b.slice(),d=1;d<=a;d++)for(var e=0;e<=a-d;e++)b[e]=b[e].multiply(1-c).add(b[e+1].multiply(c));return b[0]},chordLengthParameterize:function(a,b){for(var c=[0],d=a+1;d<=b;d++)c[d-a]=c[d-a-1]+this.points[d].getDistance(this.points[d-1]);for(var d=1,e=b-a;d<=e;d++)c[d]/=c[e];return c},findMaxError:function(a,b,c,d){for(var e=Math.floor((b-
a+1)/2),f=0,i=a+1;i<b;i++){var g=this.evaluate(3,c,d[i-a]).subtract(this.points[i]),g=g.x*g.x+g.y*g.y;g>=f&&(f=g,e=i)}return{error:f,index:e}}}),V=this.TextItem=I.extend({initialize:function(){this.base();this._content="";this._characterStyle=Da.create(this);this.setCharacterStyle(this._project.getCurrentStyle());this._paragraphStyle=Ea.create(this);this.setParagraphStyle()},_clone:function(a){a._content=this._content;a.setCharacterStyle(this._characterStyle);a.setParagraphStyle(this._paragraphStyle);
return this.base(a)},getContent:function(){return this._content},setContent:function(a){this._changed(65);this._content=""+a},getCharacterStyle:function(){return this._characterStyle},setCharacterStyle:function(a){this._characterStyle.initialize(a)},getParagraphStyle:function(){return this._paragraphStyle},setParagraphStyle:function(a){this._paragraphStyle.initialize(a)}}),Fa=this.PointText=V.extend({initialize:function(a){this.base();a=j.read(arguments);this._point=aa.create(this,"setPoint",a.x,
a.y);this._matrix=(new z).translate(a)},clone:function(){var a=this._clone(new Fa(this._point));a._matrix.initialize(this._matrix);return a},getPoint:function(){return this._point},setPoint:function(a){this._transform((new z).translate(j.read(arguments).subtract(this._point)))},getPosition:function(){return this._point},setPosition:function(a){this.setPoint.apply(this,arguments)},_transform:function(a){this._matrix.preConcatenate(a);a._transformPoint(this._point,this._point,!0)},draw:function(a){if(this._content){a.save();
a.font=this.getFontSize()+"pt "+this.getFont();a.textAlign=this.getJustification();this._matrix.applyToContext(a);var b=this.getFillColor(),c=this.getStrokeColor();if(!b||!c)a.globalAlpha=this._opacity;if(b)a.fillStyle=b.getCanvasStyle(a),a.fillText(this._content,0,0);if(c)a.strokeStyle=c.getCanvasStyle(a),a.strokeText(this._content,0,0);a.restore()}}}),qa=I.extend({initialize:function(a){var b=a instanceof qa;return n.each(this._defaults,function(c,d){c=a&&a[d]||c;this[d]=c&&b&&c.clone?c.clone():
c},this)},statics:{create:function(a){var b=new this(this.dont);b._item=a;return b},extend:function(a){var b=a._style,c=a._flags||{};a._owner.inject(n.each(a._defaults,function(d,e){var f=!!e.match(/Color$/),i=n.capitalize(e),g="set"+i,h="get"+i;a[g]=function(a){var d=this._item&&this._item._children,a=f?Q.read(arguments):a;if(d)for(var h=0,i=d.length;h<i;h++)d[h][b][g](a);else if(d=this["_"+e],d!=a&&(!d||!d.equals||!d.equals(a)))this["_"+e]=a,f&&(d&&d._removeOwner(this._item),a&&a._addOwner(this._item)),
this._item&&this._item._changed(c[e]||17);return this};a[h]=function(){var a=this._item&&this._item._children,c;if(!a)return this["_"+e];for(var d=0,f=a.length;d<f;d++){var g=a[d][b][h]();if(c){if(c!=g&&(!c||!c.equals||!c.equals(g)))return}else c=g}return c};this[g]=function(a){this[b][g](a);return this};this[h]=function(){return this[b][h]()}},{}));return this.base(a)}}}),ha=this.PathStyle=qa.extend({_defaults:{fillColor:void 0,strokeColor:void 0,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",
miterLimit:10,dashOffset:0,dashArray:[]},_flags:{strokeWidth:25,strokeCap:25,strokeJoin:25,miterLimit:25},_owner:I,_style:"_style"}),Ea=this.ParagraphStyle=qa.extend({_defaults:{justification:"left"},_owner:V,_style:"_paragraphStyle"}),Da=this.CharacterStyle=ha.extend({_defaults:n.merge(ha.prototype._defaults,{fillColor:"black",fontSize:10,font:"sans-serif"}),_owner:V,_style:"_characterStyle"}),Q=this.Color=n.extend(new function(){function a(a){var b=d[a];if(b)return b.clone();if(!e)e=O.getCanvas(r.create(1,
1)).getContext("2d"),e.globalCompositeOperation="copy";e.fillStyle="rgba(0,0,0,0)";e.fillStyle=a;e.fillRect(0,0,1,1);b=e.getImageData(0,0,1,1).data;return(d[a]=T.read([b[0]/255,b[1]/255,b[2]/255])).clone()}function b(a){a=a.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);if(4<=a.length){for(var b=Array(3),c=0;3>c;c++){var d=a[c+1];b[c]=parseInt(1==d.length?d+d:d,16)/255}return T.read(b)}}var c={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"]},
d={},e,f=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],i={"rgb-hsb":function(a){var b=a._red,c=a._green,d=a._blue,e=Math.max(b,c,d),f=Math.min(b,c,d),f=e-f;return new ra(0==f?0:60*(e==b?(c-d)/f+(c<d?6:0):e==c?(d-b)/f+2:(b-c)/f+4),0==e?0:f/e,e,a._alpha)},"hsb-rgb":function(a){var b=a._hue/60%6,c=a._saturation,d=a._brightness,e=Math.floor(b),b=b-e,e=f[e],c=[d,d*(1-c),d*(1-c*b),d*(1-c*(1-b))];return new T(c[e[0]],c[e[1]],c[e[2]],a._alpha)},"rgb-hsl":function(a){var b=a._red,c=a._green,d=a._blue,
e=Math.max(b,c,d),f=Math.min(b,c,d),g=e-f,i=(e+f)/2;return new sa(0==g?0:60*(e==b?(c-d)/g+(c<d?6:0):e==c?(d-b)/g+2:(b-c)/g+4),0.5>i?g/(e+f):g/(2-e-f),i,a._alpha)},"hsl-rgb":function(a){var b=a._saturation,c=a._hue/360,d=a._lightness,e;if(0==b)return new T(d,d,d,a._alpha);c=[c+1/3,c,c-1/3];b=0.5>d?d*(1+b):d+b-d*b;d=2*d-b;e=[];for(var f=0;3>f;f++){var g=c[f];0>g&&(g+=1);1<g&&(g-=1);e[f]=1>6*g?d+6*(b-d)*g:1>2*g?b:2>3*g?d+6*(b-d)*(2/3-g):d}return new T(e[0],e[1],e[2],a._alpha)},"rgb-gray":function(a){return new ta(1-
(0.2989*a._red+0.587*a._green+0.114*a._blue),a._alpha)},"gray-rgb":function(a){var b=1-a._gray;return new T(b,b,b,a._alpha)},"gray-hsb":function(a){return new ra(0,0,1-a._gray,a._alpha)},"gray-hsl":function(a){return new sa(0,0,1-a._gray,a._alpha)}},g={_readNull:!0,initialize:function(c){var d=Array.isArray(c),e=this._colorType;if("object"===typeof c&&!d)return e?Q.read(arguments).convert(e):void 0!==c.red?new T(c.red,c.green,c.blue,c.alpha):void 0!==c.gray?new ta(c.gray,c.alpha):void 0!==c.lightness?
new sa(c.hue,c.saturation,c.lightness,c.alpha):void 0!==c.hue?new ra(c.hue,c.saturation,c.brightness,c.alpha):new T;if("string"===typeof c)return d=c.match(/^#[0-9a-f]{3,6}$/i)?b(c):a(c),e?d.convert(e):d;var f=d?c:Array.prototype.slice.call(arguments);if(e)n.each(this._components,function(a,b){var c=f[b];this["_"+a]=void 0!==c?c:null},this);else return 3<=f.length?new T(f):new ta(f)},clone:function(){for(var a=this.constructor,a=new a(a.dont),b=this._components,c=0,d=b.length;c<d;c++){var e="_"+b[c];
a[e]=this[e]}return a},convert:function(a){var b;return this._colorType==a?this.clone():(b=i[this._colorType+"-"+a])?b(this):i["rgb-"+a](i[this._colorType+"-rgb"](this))},statics:{extend:function(a){a.beans=!0;if(a._colorType){var b=c[a._colorType];a._components=b.concat(["alpha"]);n.each(b,function(a){var b="hue"===a,c=n.capitalize(a),a="_"+a;this["get"+c]=function(){return this[a]};this["set"+c]=function(c){this[a]=b?(c%360+360)%360:Math.min(Math.max(c,0),1);this._changed();return this}},a)}return this.base(a)}}};
n.each(c,function(a,b){n.each(a,function(a){var c=n.capitalize(a);g["get"+c]=function(){return this.convert(b)[a]};g["set"+c]=function(c){var d=this.convert(b);d[a]=c;for(var d=d.convert(this._colorType),c=0,e=this._components.length;c<e;c++){var f=this._components[c];this[f]=d[f]}}})});return g},{_changed:function(){this._cssString=null;for(var a=0,b=this._owners&&this._owners.length;a<b;a++)this._owners[a]._changed(17)},_addOwner:function(a){if(!this._owners)this._owners=[];this._owners.push(a)},
_removeOwner:function(a){a=this._owners?this._owners.indexOf(a):-1;-1!=a&&(this._owners.splice(a,1),0==this._owners.length&&delete this._owners)},getType:function(){return this._colorType},getComponents:function(){for(var a=this._components.length,b=Array(a),c=0;c<a;c++)b[c]=this["_"+this._components[c]];return b},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(a){this._alpha=null==a?null:Math.min(Math.max(a,0),1);this._changed();return this},hasAlpha:function(){return null!=
this._alpha},equals:function(a){if(a&&a._colorType===this._colorType){for(var b=0,c=this._components.length;b<c;b++){var d="_"+this._components[b];if(this[d]!==a[d])return!1}return!0}return!1},toString:function(){for(var a=[],b=n.formatNumber,c=0,d=this._components.length;c<d;c++){var e=this._components[c],f=this["_"+e];"alpha"===e&&null==f&&(f=1);a.push(e+": "+b(f))}return"{ "+a.join(", ")+" }"},toCssString:function(){if(!this._cssString){var a=this.convert("rgb"),b=a.getAlpha();this._cssString=
"rgba("+[Math.round(255*a._red),Math.round(255*a._green),Math.round(255*a._blue),null!=b?b:1].join(", ")+")"}return this._cssString},getCanvasStyle:function(){return this.toCssString()}}),ta=this.GrayColor=Q.extend({_colorType:"gray"}),T=this.RGBColor=Q.extend({_colorType:"rgb"}),ra=this.HSBColor=Q.extend({_colorType:"hsb"}),sa=this.HSLColor=Q.extend({_colorType:"hsl"}),Ga=this.GradientColor=Q.extend({initialize:function(a,b,c,d){this.gradient=a||new ya;this.setOrigin(b);this.setDestination(c);d&&
this.setHilite(d)},clone:function(){return new Ga(this.gradient,this._origin,this._destination,this._hilite)},getOrigin:function(){return this._origin},setOrigin:function(a){this._origin=a=j.read(arguments).clone();if(this._destination)this._radius=this._destination.getDistance(this._origin);this._changed();return this},getDestination:function(){return this._destination},setDestination:function(a){this._destination=a=j.read(arguments).clone();this._radius=this._destination.getDistance(this._origin);
this._changed();return this},getHilite:function(){return this._hilite},setHilite:function(a){var a=j.read(arguments).clone(),b=a.subtract(this._origin);this._hilite=b.getLength()>this._radius?this._origin.add(b.normalize(this._radius-0.1)):a;this._changed();return this},getCanvasStyle:function(a){if("linear"===this.gradient.type)a=a.createLinearGradient(this._origin.x,this._origin.y,this._destination.x,this._destination.y);else var b=this._hilite||this._origin,a=a.createRadialGradient(b.x,b.y,0,this._origin.x,
this._origin.y,this._radius);for(var b=0,c=this.gradient._stops.length;b<c;b++){var d=this.gradient._stops[b];a.addColorStop(d._rampPoint,d._color.toCssString())}return a},equals:function(a){return a==this||a&&a._colorType===this._colorType&&this.gradient.equals(a.gradient)&&this._origin.equals(a._origin)&&this._destination.equals(a._destination)},transform:function(a){a._transformPoint(this._origin,this._origin,!0);a._transformPoint(this._destination,this._destination,!0);this._hilite&&a._transformPoint(this._hilite,
this._hilite,!0);this._radius=this._destination.getDistance(this._origin)}}),ya=this.Gradient=n.extend({initialize:function(a,b){this.setStops(a||["white","black"]);this.type=b||"linear"},clone:function(){for(var a=[],b=0,c=this._stops.length;b<c;b++)a[b]=this._stops[b].clone();return new ya(a,this.type)},getStops:function(){return this._stops},setStops:function(a){if(2>a.length)throw Error("Gradient stop list needs to contain at least two stops.");this._stops=ua.readAll(a);for(var a=0,b=this._stops.length;a<
b;a++){var c=this._stops[a];c._defaultRamp&&c.setRampPoint(a/(b-1))}},equals:function(a){if(a.type!=this.type)return!1;if(this._stops.length==a._stops.length){for(var b=0,c=this._stops.length;b<c;b++)if(!this._stops[b].equals(a._stops[b]))return!1;return!0}return!1}}),ua=this.GradientStop=n.extend({initialize:function(a,b){void 0===b&&Array.isArray(a)?(this.setColor(a[0]),this.setRampPoint(a[1])):a.color?(this.setColor(a.color),this.setRampPoint(a.rampPoint)):(this.setColor(a),this.setRampPoint(b))},
clone:function(){return new ua(this._color.clone(),this._rampPoint)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(a){this._defaultRamp=null==a;this._rampPoint=a||0},getColor:function(){return this._color},setColor:function(a){this._color=Q.read(arguments)},equals:function(a){return a==this||a instanceof ua&&this._color.equals(a._color)&&this._rampPoint==a._rampPoint}}),P={getBounds:function(a,b){var c=a.getBoundingClientRect(),d=a.ownerDocument,e=d.body,f=d.documentElement,
i=c.left-(f.clientLeft||e.clientLeft||0),g=c.top-(f.clientTop||e.clientTop||0);b||(d=P.getViewport(d),i+=d.pageXOffset||f.scrollLeft||e.scrollLeft,g+=d.pageYOffset||f.scrollTop||e.scrollTop);return new u(i,g,c.width,c.height)},getOffset:function(a,b){return this.getBounds(a,b).getPoint()},getSize:function(a){return this.getBounds(a,!0).getSize()},isInvisible:function(a){return this.getSize(a).equals([0,0])},isVisible:function(a){return!this.isInvisible(a)&&this.getViewportBounds(a).intersects(this.getBounds(a,
!0))},getViewport:function(a){return a.defaultView||a.parentWindow},getViewportBounds:function(a){var b=a.ownerDocument,a=this.getViewport(b),b=b.getElementsByTagName("CSS1Compat"===b.compatMode?"html":"body")[0];return u.create(0,0,a.innerWidth||b.clientWidth,a.innerHeight||b.clientHeight)},getComputedStyle:function(a,b){if(a.currentStyle)return a.currentStyle[n.camelize(b)];var c=this.getViewport(a.ownerDocument).getComputedStyle(a,null);return c?c.getPropertyValue(n.hyphenate(b)):null}},G={add:function(a,
b){for(var c in b){var d=b[c];if(a.addEventListener)a.addEventListener(c,d,!1);else if(a.attachEvent)a.attachEvent("on"+c,d.bound=function(){d.call(a,window.event)})}},remove:function(a,b){for(var c in b){var d=b[c];a.removeEventListener?a.removeEventListener(c,d,!1):a.detachEvent&&a.detachEvent("on"+c,d.bound)}},getPoint:function(a){a=a.targetTouches?a.targetTouches.length?a.targetTouches[0]:a.changedTouches[0]:a;return j.create(a.pageX||a.clientX+document.documentElement.scrollLeft,a.pageY||a.clientY+
document.documentElement.scrollTop)},getTarget:function(a){return a.target||a.srcElement},getOffset:function(a,b){return G.getPoint(a).subtract(P.getOffset(b||G.getTarget(a)))},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},stop:function(a){G.stopPropagation(a);G.preventDefault(a)}};G.requestAnimationFrame=new function(){var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;a&&a(function(b){void 0==b&&(a=null)});var b=[],c=!0,d;G.add(window,{focus:function(){c=!0},blur:function(){c=!1}});return function(e,f){if(a)return a(e,f);b.push([e,f]);d||(d=window.setInterval(function(){for(var a=b.length-1;0<=a;a--){var d=b[a],e=d[0],d=d[1];if(!d||("true"==fa.getAttribute(d,"keepalive")||c)&&P.isVisible(d))b.splice(a,1),e(Date.now())}},1E3/60))}};var K=this.View=ka.extend({_list:"views",
_reference:"view",initialize:function(a){this.base();var b;"string"===typeof a&&(a=document.getElementById(a));if(a instanceof HTMLCanvasElement){this._canvas=a;if(fa.hasAttribute(a,"resize")){var c=P.getOffset(a,!0),d=this;b=P.getViewportBounds(a).getSize().subtract(c);a.width=b.width;a.height=b.height;G.add(window,{resize:function(){P.isInvisible(a)||(c=P.getOffset(a,!0));d.setViewSize(P.getViewportBounds(a).getSize().subtract(c))}})}else b=P.isInvisible(a)?r.create(parseInt(a.getAttribute("width")),
parseInt(a.getAttribute("height"))):P.getSize(a);if(fa.hasAttribute(a,"stats")){this._stats=new Stats;var e=this._stats.domElement,f=e.style,c=P.getOffset(a);f.position="absolute";f.left=c.x+"px";f.top=c.y+"px";document.body.appendChild(e)}}else b=r.read(arguments,1),b.isZero()&&(b=new r(1024,768)),this._canvas=O.getCanvas(b);this._id=this._canvas.getAttribute("id");if(null==this._id)this._canvas.setAttribute("id",this._id="canvas-"+K._id++);K._views[this._id]=this;this._viewSize=ga.create(this,"setViewSize",
b.width,b.height);this._context=this._canvas.getContext("2d");this._matrix=new z;this._zoom=1;this._events=this._createEvents();G.add(this._canvas,this._events);if(!K._focused)K._focused=this;this._scope._redrawNotified=!1},remove:function(){if(!this.base())return!1;if(K._focused==this)K._focused=null;delete K._views[this._id];G.remove(this._canvas,this._events);this._canvas=this._events=this._onFrame=null;return!0},getCanvas:function(){return this._canvas},getViewSize:function(){return this._viewSize},
setViewSize:function(a){var a=r.read(arguments),b=a.subtract(this._viewSize);if(!b.isZero()){this._canvas.width=a.width;this._canvas.height=a.height;this._viewSize.set(a.width,a.height,!0);this._bounds=null;this._redrawNeeded=!0;if(this.onResize)this.onResize({size:a,delta:b});this._onFrameCallback?this._onFrameCallback(0,!0):this.draw(!0)}},getBounds:function(){if(!this._bounds)this._bounds=this._matrix._transformBounds(new u(new j,this._viewSize));return this._bounds},getSize:function(){return this.getBounds().getSize()},
getCenter:function(){return this.getBounds().getCenter()},setCenter:function(a){this.scrollBy(j.read(arguments).subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(a){this._transform((new z).scale(a/this._zoom,this.getCenter()));this._zoom=a},isVisible:function(){return P.isVisible(this._canvas)},scrollBy:function(a){this._transform((new z).translate(j.read(arguments).negate()))},_transform:function(a){this._matrix.preConcatenate(a);this._inverse=this._bounds=null},
draw:function(a){if(a&&!this._redrawNeeded)return!1;this._stats&&this._stats.update();var a=this._context,b=this._viewSize;a.clearRect(0,0,b._width+1,b._height+1);a.save();this._matrix.applyToContext(a);this._scope.project.draw(a);a.restore();if(this._redrawNeeded)this._redrawNeeded=!1,this._scope._redrawNotified=!1;return!0},projectToView:function(a){return this._matrix._transformPoint(j.read(arguments))},viewToProject:function(a){return this._getInverse()._transformPoint(j.read(arguments))},_getInverse:function(){if(!this._inverse)this._inverse=
this._matrix.createInverse();return this._inverse},getOnFrame:function(){return this._onFrame},setOnFrame:function(a){if(this._onFrame=a){var b=this,c=!1,d,e=0,f=0;this._onFrameCallback=function(a,g){c=!1;if(b._onFrame){paper=b._scope;c=!0;g||G.requestAnimationFrame(b._onFrameCallback,b._canvas);var h=Date.now()/1E3,l=d?h-d:0;b._onFrame(n.merge({delta:l,time:e+=l,count:f++}));d=h;b.draw(!0)}};c||this._onFrameCallback()}else delete this._onFrameCallback},onResize:null},new function(){function a(){(!K._focused||
!K._focused.isVisible())&&Y.each(function(a){for(var b=0,c=a.views.length;b<c;b++){var d=a.views[b];if(d.isVisible())throw K._focused=g=d,n.stop;}})}function b(b){var c;if(!h)if(c=K._views[G.getTarget(b).getAttribute("id")])K._focused=g=c;else if(g&&g==K._focused)K._focused=null,a();if((c=c||K._focused)&&(e=c._scope.tool)){var d=b&&c.viewToProject(G.getOffset(b,c._canvas)),f=!(e.onMouseDrag||!e.onMouseMove);if(h&&!f){if((i=d||i)&&e.onHandleEvent("mousedrag",i,b))c.draw(!0),G.stop(b)}else if((!h||
f)&&e.onHandleEvent("mousemove",d,b))c.draw(!0),G.stop(b)}}function c(a){var b=K._focused;b&&h&&(h=!1,i=null,e&&(null!=f&&(f=clearInterval(f)),e.onHandleEvent("mouseup",b.viewToProject(G.getOffset(a,b._canvas)),a)&&(b.draw(!0),G.stop(a))))}function d(a){h&&G.stop(a)}var e,f,i,g,h=!1;G.add(document,{mousemove:b,mouseup:c,touchmove:b,touchend:c,selectstart:d,scroll:a});G.add(window,{load:a});return{_createEvents:function(){function a(d){K._focused=c;if(e=c._scope.tool)i=c.viewToProject(G.getOffset(d,
c._canvas)),e.onHandleEvent("mousedown",i,d)&&c.draw(!0),null!=e.eventInterval&&(f=setInterval(b,e.eventInterval)),h=!0}var c=this;return{mousedown:a,touchstart:a,selectstart:d}},statics:{_views:{},_id:0,updateFocus:a}}}),V=this.Event=n.extend({initialize:function(a){this.event=a},preventDefault:function(){G.preventDefault(this.event)},stopPropagation:function(){G.stopPropagation(this.event)},stop:function(){G.stop(this.event)},getModifiers:function(){return Ha.modifiers}}),Ia=this.KeyEvent=V.extend(new function(){return{initialize:function(a,
b,c,d){this.base(d);this.type=a?"keydown":"keyup";this.key=b;this.character=c},toString:function(){return"{ type: "+this.type+", key: "+this.key+", character: "+this.character+", modifiers: "+this.getModifiers()+" }"}}}),Ha=this.Key=new function(){function a(a,c,d,f){var d=String.fromCharCode(d),m=b[c]||d.toLowerCase(),c=a?"onKeyDown":"onKeyUp",j=K._focused,o=j&&j.isVisible()&&j._scope,o=o&&o.tool;e[m]=a;o&&o[c]&&(a=new Ia(a,m,d,f),!1===o[c](a)&&a.preventDefault(),j&&j.draw(!0))}var b={8:"backspace",
13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command"},c=n.merge({shift:!1,control:!1,option:!1,command:!1,capsLock:!1}),d={},e={},f;G.add(document,{keydown:function(e){var g=e.which||e.keyCode,h=b[g];h?void 0!==c[h=n.camelize(h)]?c[h]=!0:(d[g]=0,a(!0,g,null,e)):f=g},keypress:function(b){if(null!=f){var c=b.which||b.keyCode;d[f]=c;a(!0,f,c,b);f=null}},keyup:function(e){var f=
e.which||e.keyCode,h=b[f],l;h&&void 0!==c[l=n.camelize(h)]?c[l]=!1:null!=d[f]&&(a(!1,f,d[f],e),delete d[f])}});return{modifiers:c,isDown:function(a){return!!e[a]}}},Z=this.ToolEvent=V.extend({initialize:function(a,b,c){this.tool=a;this.type=b;this.event=c},_choosePoint:function(a,b){return a?a:b?b.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(a){this._point=a},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},
setLastPoint:function(a){this._lastPoint=a},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(a){this._downPoint=a},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this.middlePoint},setMiddlePoint:function(a){this._middlePoint=a},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(a){this._delta=
a},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(a){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=a},getItem:function(){if(!this._item){var a=this.tool._scope.project.hitTest(this.getPoint());if(a){for(var a=a.item,b=a._parent;b instanceof na&&!(b instanceof ia)||b instanceof wa;)a=b,b=b._parent;this._item=a}}return this._item},setItem:function(a){this._item=a},toString:function(){return"{ type: "+this.type+
", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Ja=this.Tool=ka.extend({_list:"tools",_reference:"tool",initialize:function(){this.base();this._firstMove=!0;this._downCount=this._count=0},eventInterval:null,getMinDistance:function(){return this._minDistance},setMinDistance:function(a){this._minDistance=a;if(null!=this._minDistance&&null!=this._maxDistance&&this._minDistance>this._maxDistance)this._maxDistance=this._minDistance},getMaxDistance:function(){return this._maxDistance},
setMaxDistance:function(a){this._maxDistance=a;if(null!=this._minDistance&&null!=this._maxDistance&&this._maxDistance<this._minDistance)this._minDistance=a},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(a){this._maxDistance=this._minDistance=a},updateEvent:function(a,b,c,d,e,f,i){if(!e){if(null!=c||null!=d){var g=null!=c?c:0,c=b.subtract(this._point),h=c.getLength();if(h<g)return!1;d=null!=d?d:0;if(0!=d)if(h>d)b=this._point.add(c.normalize(d));
else if(i)return!1}if(f&&b.equals(this._point))return!1}this._lastPoint=e&&"mousemove"==a?b:this._point;this._point=b;switch(a){case "mousedown":this._lastPoint=this._downPoint;this._downPoint=this._point;this._downCount++;break;case "mouseup":this._lastPoint=this._downPoint}this._count=e?0:this._count+1;return!0},onHandleEvent:function(a,b,c){paper=this._scope;var d=!1;switch(a){case "mousedown":this.updateEvent(a,b,null,null,!0,!1,!1);this.onMouseDown&&(this.onMouseDown(new Z(this,a,c)),d=!0);break;
case "mousedrag":for(var e=!1,f=!1;this.updateEvent(a,b,this.minDistance,this.maxDistance,!1,e,f);)this.onMouseDrag&&(this.onMouseDrag(new Z(this,a,c)),d=!0),f=e=!0;break;case "mouseup":if((this._point.x!=b.x||this._point.y!=b.y)&&this.updateEvent("mousedrag",b,this.minDistance,this.maxDistance,!1,!1,!1)&&this.onMouseDrag)this.onMouseDrag(new Z(this,a,c)),d=!0;this.updateEvent(a,b,null,this.maxDistance,!1,!1,!1);this.onMouseUp&&(this.onMouseUp(new Z(this,a,c)),d=!0);this.updateEvent(a,b,null,null,
!0,!1,!1);this._firstMove=!0;break;case "mousemove":for(;this.updateEvent(a,b,this.minDistance,this.maxDistance,this._firstMove,!0,!1);)this.onMouseMove&&(this.onMouseMove(new Z(this,a,c)),d=!0),this._firstMove=!1}return d}}),O={canvases:[],getCanvas:function(a){if(this.canvases.length){var b=this.canvases.pop();b.width!=a.width||b.height!=a.height?(b.width=a.width,b.height=a.height):b.getContext("2d").clearRect(0,0,a.width+1,a.height+1)}else b=document.createElement("canvas"),b.width=a.width,b.height=
a.height;return b},returnCanvas:function(a){this.canvases.push(a)}},J=new function(){var a=[[0.5773502691896257],[0,0.7745966692414834],[0.33998104358485626,0.8611363115940526],[0,0.5384693101056831,0.906179845938664],[0.2386191860831969,0.6612093864662645,0.932469514203152],[0,0.4058451513773972,0.7415311855993945,0.9491079123427585],[0.1834346424956498,0.525532409916329,0.7966664774136267,0.9602898564975363],[0,0.3242534234038089,0.6133714327005904,0.8360311073266358,0.9681602395076261],[0.14887433898163122,
0.4333953941292472,0.6794095682990244,0.8650633666889845,0.9739065285171717],[0,0.26954315595234496,0.5190961292068118,0.7301520055740494,0.8870625997680953,0.978228658146057],[0.1252334085114689,0.3678314989981802,0.5873179542866175,0.7699026741943047,0.9041172563704749,0.9815606342467192],[0,0.2304583159551348,0.44849275103644687,0.6423493394403402,0.8015780907333099,0.9175983992229779,0.9841830547185881],[0.10805494870734367,0.31911236892788974,0.5152486363581541,0.6872929048116855,0.827201315069765,
0.9284348836635735,0.9862838086968123],[0,0.20119409399743451,0.3941513470775634,0.5709721726085388,0.7244177313601701,0.8482065834104272,0.937273392400706,0.9879925180204854],[0.09501250983763744,0.2816035507792589,0.45801677765722737,0.6178762444026438,0.755404408355003,0.8656312023878318,0.9445750230732326,0.9894009349916499]],b=[[1],[0.8888888888888888,0.5555555555555556],[0.6521451548625461,0.34785484513745385],[0.5688888888888889,0.47862867049936647,0.23692688505618908],[0.46791393457269104,
0.3607615730481386,0.17132449237917036],[0.4179591836734694,0.3818300505051189,0.27970539148927664,0.1294849661688697],[0.362683783378362,0.31370664587788727,0.22238103445337448,0.10122853629037626],[0.3302393550012598,0.31234707704000286,0.26061069640293544,0.1806481606948574,0.08127438836157441],[0.29552422471475287,0.26926671930999635,0.21908636251598204,0.1494513491505806,0.06667134430868814],[0.2729250867779006,0.26280454451024665,0.23319376459199048,0.18629021092773426,0.1255803694649046,0.05566856711617366],
[0.24914704581340277,0.2334925365383548,0.20316742672306592,0.16007832854334622,0.10693932599531843,0.04717533638651183],[0.2325515532308739,0.22628318026289723,0.2078160475368885,0.17814598076194574,0.13887351021978725,0.09212149983772845,0.04048400476531588],[0.2152638534631578,0.2051984637212956,0.18553839747793782,0.15720316715819355,0.12151857068790319,0.08015808715976021,0.03511946033175186],[0.2025782419255613,0.19843148532711158,0.1861610000155622,0.16626920581699392,0.13957067792615432,0.10715922046717194,
0.07036604748810812,0.03075324199611727],[0.1894506104550685,0.18260341504492358,0.16915651939500254,0.14959598881657674,0.12462897125553388,0.09515851168249279,0.062253523938647894,0.027152459411754096]],c=Math.abs,d=Math.sqrt,e=Math.cos,f=Math.PI;return{TOLERANCE:1.0E-5,EPSILON:1.0E-11,integrate:function(c,d,e,f){for(var m=a[f-2],j=b[f-2],e=0.5*(e-d),d=e+d,o=0,n=f+1>>1,f=f&1?j[o++]*c(d):0;o<n;)var q=e*m[o],f=f+j[o++]*(c(d+q)+c(d-q));return e*f},findRoot:function(a,b,d,e,f,j,o){for(var n=0;n<j;n++){var q=
a(d),s=q/b(d);if(c(s)<o)return d;s=d-s;0<q?(f=d,d=s<=e?0.5*(e+f):s):(e=d,d=s>=f?0.5*(e+f):s)}},solveQuadratic:function(a,b,e,f,m){if(c(a)<m)return c(b)>=m?(f[0]=-e/b,1):c(e)<m?-1:0;var j=b*b-4*a*e;if(0>j)return 0;j=d(j);0>b&&(j=-j);j=-0.5*(b+j);b=0;c(j)>=m&&(f[b++]=e/j);c(a)>=m&&(f[b++]=j/a);return b},solveCubic:function(a,b,h,j,m,n){if(c(a)<n)return J.solveQuadratic(b,h,j,m,n);var b=b/a,h=h/a,o=(b*b-3*h)/9,a=(2*b*b*b-9*b*h+27*(j/a))/54,h=o*o*o,j=a*a,b=b/3;if(j<h)return n=Math.acos(a/d(h)),o=-2*d(o),
m[0]=o*e(n/3)-b,m[1]=o*e((n+2*f)/3)-b,m[2]=o*e((n-2*f)/3)-b,3;h=-Math.pow(c(a)+d(j-h),1/3);0>a&&(h=-h);o=c(h)<n?0:o/h;m[0]=h+o-b;return 1}}},Ba={process:function(a,b,c,d,e){function f(a,b,c){return 0.2989*a+0.587*b+0.114*c}function i(a,b,c,d){d-=f(a,b,c);r=a+d;u=b+d;H=c+d;d=f(r,u,H);b=n(r,u,H);a=o(r,u,H);0>b&&(b=d-b,r=d+(r-d)*d/b,u=d+(u-d)*d/b,H=d+(H-d)*d/b);255<a&&(b=255-d,a-=d,r=d+(r-d)*b/a,u=d+(u-d)*b/a,H=d+(H-d)*b/a)}function g(a,b,c,d){var e=[a,b,c],f=o(a,b,c),c=n(a,b,c),c=c==a?0:c==b?1:2,f=
f==a?0:f==b?1:2,a=0==n(c,f)?1==o(c,f)?2:1:0;e[f]>e[c]?(e[a]=(e[a]-e[c])*d/(e[f]-e[c]),e[f]=d):e[a]=e[f]=0;e[c]=0;r=e[0];u=e[1];H=e[2]}var h=b.canvas,j=c.getImageData(e.x,e.y,h.width,h.height),m=j.data,b=b.getImageData(0,0,h.width,h.height).data,n=Math.min,o=Math.max,t=Math.abs,q,s,y,v,A,F,r,u,H,E={multiply:function(){r=v*q/255;u=A*s/255;H=F*y/255},screen:function(){r=255-(255-v)*(255-q)/255;u=255-(255-A)*(255-s)/255;H=255-(255-F)*(255-y)/255},overlay:function(){r=128>v?2*v*q/255:255-2*(255-v)*(255-
q)/255;u=128>A?2*A*s/255:255-2*(255-A)*(255-s)/255;H=128>F?2*F*y/255:255-2*(255-F)*(255-y)/255},"soft-light":function(){var a=q*v/255;r=a+v*(255-(255-v)*(255-q)/255-a)/255;a=s*A/255;u=a+A*(255-(255-A)*(255-s)/255-a)/255;a=y*F/255;H=a+F*(255-(255-F)*(255-y)/255-a)/255},"hard-light":function(){r=128>q?2*q*v/255:255-2*(255-q)*(255-v)/255;u=128>s?2*s*A/255:255-2*(255-s)*(255-A)/255;H=128>y?2*y*F/255:255-2*(255-y)*(255-F)/255},"color-dodge":function(){r=255==q?q:n(255,255*v/(255-q));u=255==s?s:n(255,255*
A/(255-s));H=255==y?y:n(255,255*F/(255-y))},"color-burn":function(){r=0==q?0:o(255-255*(255-v)/q,0);u=0==s?0:o(255-255*(255-A)/s,0);H=0==y?0:o(255-255*(255-F)/y,0)},darken:function(){r=v<q?v:q;u=A<s?A:s;H=F<y?F:y},lighten:function(){r=v>q?v:q;u=A>s?A:s;H=F>y?F:y},difference:function(){r=v-q;0>r&&(r=-r);u=A-s;0>u&&(u=-u);H=F-y;0>H&&(H=-H)},exclusion:function(){r=v+q*(255-v-v)/255;u=A+s*(255-A-A)/255;H=F+y*(255-F-F)/255},hue:function(){g(q,s,y,o(v,A,F)-n(v,A,F));i(r,u,H,f(v,A,F))},saturation:function(){g(v,
A,F,o(q,s,y)-n(q,s,y));i(r,u,H,f(v,A,F))},luminosity:function(){i(v,A,F,f(q,s,y))},color:function(){i(q,s,y,f(v,A,F))},add:function(){r=n(v+q,255);u=n(A+s,255);H=n(F+y,255)},subtract:function(){r=o(v-q,0);u=o(A-s,0);H=o(F-y,0)},average:function(){r=(v+q)/2;u=(A+s)/2;H=(F+y)/2},negation:function(){r=255-t(255-q-v);u=255-t(255-s-A);H=255-t(255-y-F)}}[a];if(E){for(var z=0,G=m.length;z<G;z+=4){q=b[z];v=m[z];s=b[z+1];A=m[z+1];y=b[z+2];F=m[z+2];a=b[z+3];h=m[z+3];E();var J=a*d/255,K=1-J;m[z]=J*r+K*v;m[z+
1]=J*u+K*A;m[z+2]=J*H+K*F;m[z+3]=a*d+K*h}c.putImageData(j,e.x,e.y)}}},fa=this.PaperScript=new function(){function a(a){a=a[0];return"num"!=a&&"string"!=a}function b(b,c,d){if(h[b]&&a(c))return["call",["name","$eval"],[c,["string",b],d]]}function c(c){var d=g.parse(c),c=g.ast_walker(),e=c.walk,d=c.with_walkers({binary:function(a,c,d){return b(a,c=e(c),d=e(d))||[this[0],a,c,d]},assign:function(a,c,d){var f=b(a,c=e(c),d=e(d));return f?[this[0],!0,c,f]:[this[0],a,c,d]},"unary-prefix":function(b,c){if(j[b]&&
a(c))return["call",["name","$sign"],[["string",b],e(c)]]}},function(){return e(d)});return g.gen_code(d,{beautify:!0})}function d(a,b){paper=b;var d=b.view,e=/on(?:Key|Mouse)(?:Up|Down|Move|Drag)/.test(a)&&new Ja,f;with(b)(function(){var b="onEditOptions,onSelect,onDeselect,onReselect,onMouseDown,onMouseUp,onMouseDrag,onMouseMove,onKeyDown,onKeyUp".split(",");f=eval(c(a));e&&n.each(b,function(a){e[a]=eval(a)});if(d)d.onResize=void 0,d.setOnFrame(void 0),d.draw()}).call(b);return f}function e(a,b){var c=
new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");c.open("GET",a,!0);c.overrideMimeType&&c.overrideMimeType("text/plain");c.onreadystatechange=function(){if(4===c.readyState)return d(c.responseText,b)};return c.send(null)}function f(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;b<c;b++){var f=a[b];if(/^text\/(?:x-|)paperscript$/.test(f.type)&&!f.getAttribute("data-paper-loaded")){var g=new Y(f);g.setup(fa.getAttribute(f,"canvas"));f.src?e(f.src,g):d(f.innerHTML,
g);f.setAttribute("data-paper-loaded",!0)}}}function i(a){a+="Attribute";return function(b,c){return b[a](c)||b[a]("data-paper-"+c)}}var g=new function(){function a(b,c,d){for(var e=[],f=0;f<b.length;++f)e.push(c.call(d,b[f],f));return e}function b(a,c){var d={};!0===a&&(a={});for(var e in c)f(c,e)&&(d[e]=a&&f(a,e)?a[e]:c[e]);return d}function c(a){var b=0,d=0,a=a.replace(/[\\\b\f\n\r\t\x22\x27]/g,function(a){switch(a){case "\\":return"\\\\";case "\u0008":return"\\b";case "\u000c":return"\\f";case "\n":return"\\n";
case "\r":return"\\r";case "\t":return"\\t";case '"':return++b,'"';case "'":return++d,"'"}return a});return b>d?"'"+a.replace(/\x27/g,"\\'")+"'":'"'+a.replace(/\x22/g,'\\"')+'"'}function d(a){return!a||"block"==a[0]&&(!a[1]||0==a[1].length)}function e(){function b(a){if(null==a)return null;try{j.push(a);var c=a[0],d=h[c];if(d){var e=d.apply(a,a.slice(1));if(null!=e)return e}d=g[c];return d.apply(a,a.slice(1))}finally{j.pop()}}function c(d){var e=[this[0]];null!=d&&e.push(a(d,b));return e}function d(c){return[this[0],
a(c,function(a){var c=[a[0]];1<a.length&&(c[1]=b(a[1]));return c})]}var g={string:function(a){return[this[0],a]},num:function(a){return[this[0],a]},name:function(a){return[this[0],a]},toplevel:function(c){return[this[0],a(c,b)]},block:c,splice:c,"var":d,"const":d,"try":function(c,d,e){return[this[0],a(c,b),null!=d?[d[0],a(d[1],b)]:null,null!=e?a(e,b):null]},"throw":function(a){return[this[0],b(a)]},"new":function(c,d){return[this[0],b(c),a(d,b)]},"switch":function(c,d){return[this[0],b(c),a(d,function(c){return[c[0]?
b(c[0]):null,a(c[1],b)]})]},"break":function(a){return[this[0],a]},"continue":function(a){return[this[0],a]},conditional:function(a,c,d){return[this[0],b(a),b(c),b(d)]},assign:function(a,c,d){return[this[0],a,b(c),b(d)]},dot:function(a){return[this[0],b(a)].concat(i(arguments,1))},call:function(c,d){return[this[0],b(c),a(d,b)]},"function":function(c,d,e){return[this[0],c,d.slice(),a(e,b)]},defun:function(c,d,e){return[this[0],c,d.slice(),a(e,b)]},"if":function(a,c,d){return[this[0],b(a),b(c),b(d)]},
"for":function(a,c,d,e){return[this[0],b(a),b(c),b(d),b(e)]},"for-in":function(a,c,d,e){return[this[0],b(a),b(c),b(d),b(e)]},"while":function(a,c){return[this[0],b(a),b(c)]},"do":function(a,c){return[this[0],b(a),b(c)]},"return":function(a){return[this[0],b(a)]},binary:function(a,c,d){return[this[0],a,b(c),b(d)]},"unary-prefix":function(a,c){return[this[0],a,b(c)]},"unary-postfix":function(a,c){return[this[0],a,b(c)]},sub:function(a,c){return[this[0],b(a),b(c)]},object:function(c){return[this[0],
a(c,function(a){return 2==a.length?[a[0],b(a[1])]:[a[0],b(a[1]),a[2]]})]},regexp:function(a,b){return[this[0],a,b]},array:function(c){return[this[0],a(c,b)]},stat:function(a){return[this[0],b(a)]},seq:function(){return[this[0]].concat(a(i(arguments),b))},label:function(a,c){return[this[0],a,b(c)]},"with":function(a,c){return[this[0],b(a),b(c)]},atom:function(a){return[this[0],a]}},h={},j=[];return{walk:b,with_walkers:function(a,b){var c={},d;for(d in a)f(a,d)&&(c[d]=h[d],h[d]=a[d]);var e=b();for(d in c)f(c,
d)&&(c[d]?h[d]=c[d]:delete h[d]);return e},parent:function(){return j[j.length-2]},stack:function(){return j}}}function f(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function g(a,b){for(var c=b.length;0<=--c;)if(b[c]===a)return!0;return!1}function i(a,b){return Array.prototype.slice.call(a,b||0)}function h(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=!0;return b}function j(a){a instanceof Function&&(a=a());for(var b=1,c=arguments.length;0<--c;++b)arguments[b]();return a}function l(a){var b=
i(arguments,1);return function(){return a.apply(this,b.concat(i(arguments)))}}function n(a,b,c){this.name=a;this.start=b;this.end=c}function r(a){function b(a){if(a)return g();for(;f(R,A());)y();x.tokline=x.line;x.tokcol=x.col;x.tokpos=x.pos;a=A();if(!a)return p("eof");if(E(a))return n();if('"'==a||"'"==a)return j();if(f(aa,a))return p("punc",y());if("."==a)return y(),E(A())?n("."):p("punc",".");if("/"==a)return d();if(f(P,a))return e();if("\\"==a||"$"==a||"_"==a||G(a))return a=q(z),f(J,a)?f(T,a)?
p("operator",a):f(O,a)?p("atom",a):p("keyword",a):p("name",a);o("Unexpected character '"+a+"'")}function c(a,b){try{return b()}catch(d){if(d===Y)o(a);else throw d;}}function d(){y();var a=x.regex_allowed;switch(A()){case "/":return x.comments_before.push(h()),x.regex_allowed=a,b();case "*":return x.comments_before.push(i()),x.regex_allowed=a,b()}return x.regex_allowed?g():e("/")}function e(a){function b(a){if(!A())return a;var c=a+A();return f(T,c)?(y(),b(c)):a}return p("operator",b(a||y()))}function g(){return c("Unterminated regular expression",
function(){for(var a=!1,b="",c,d=!1;c=y(!0);)if(a)b+="\\"+c,a=!1;else if("["==c)d=!0,b+=c;else if("]"==c&&d)d=!1,b+=c;else{if("/"==c&&!d)break;"\\"==c?a=!0:b+=c}a=q(function(a){return f(ba,a)});return p("regexp",[b,a])})}function i(){y();return c("Unterminated multiline comment",function(){var a=v("*/",!0),b=x.text.substring(x.pos,a),c=p("comment2",b,!0);x.pos=a+2;x.line+=b.split("\n").length-1;x.newline_before=0<=b.indexOf("\n");return c})}function h(){y();var a=v("\n"),b;-1==a?(b=x.text.substr(x.pos),
x.pos=x.text.length):(b=x.text.substring(x.pos,a),x.pos=a);return p("comment1",b,!0)}function j(){return c("Unterminated string constant",function(){for(var a=y(),b="";;){var c=y(!0);if("\\"==c)c=l();else if(c==a)break;b+=c}return p("string",b)})}function m(a){for(var b=0;0<a;--a){var c=parseInt(y(!0),16);isNaN(c)&&o("Invalid hex-character pattern in string");b=b<<4|c}return b}function l(){var a=y(!0);switch(a){case "n":return"\n";case "r":return"\r";case "t":return"\t";case "b":return"\u0008";case "v":return"\u000b";
case "f":return"\u000c";case "0":return"\x00";case "x":return String.fromCharCode(m(2));case "u":return String.fromCharCode(m(4));case "\n":return"";default:return a}}function n(a){var b=!1,c=!1,d=!1,e="."==a,f=q(function(f,g){if("x"==f||"X"==f)return d?!1:d=!0;if(!d&&("E"==f||"e"==f))return b?!1:b=c=!0;if("-"==f)return c||0==g&&!a?!0:!1;if("+"==f)return c;c=!1;return"."==f?!e&&!d?e=!0:!1:E(f)||G(f)});a&&(f=a+f);var g=t(f);if(!isNaN(g))return p("num",g);o("Invalid syntax: "+f)}function o(a){throw new u(a,
x.tokline,x.tokcol,x.tokpos);}function q(a){for(var b="",c=A(),d=0;c&&a(c,d++);)b+=y(),c=A();return b}function p(a,b,c){x.regex_allowed="operator"==a&&!f(da,b)||"keyword"==a&&f(I,b)||"punc"==a&&f(V,b);a={type:a,value:b,line:x.tokline,col:x.tokcol,pos:x.tokpos,nlb:x.newline_before};c||(a.comments_before=x.comments_before,x.comments_before=[]);x.newline_before=!1;return a}function v(a,b){var c=x.text.indexOf(a,x.pos);if(b&&-1==c)throw Y;return c}function y(a){var b=x.text.charAt(x.pos++);if(a&&!b)throw Y;
"\n"==b?(x.newline_before=!0,++x.line,x.col=0):++x.col;return b}function A(){return x.text.charAt(x.pos)}var x={text:a.replace(/\r\n?|[\n\u2028\u2029]/g,"\n").replace(/^\uFEFF/,""),pos:0,tokpos:0,line:0,tokline:0,col:0,tokcol:0,newline_before:!1,regex_allowed:!1,comments_before:[]};b.context=function(a){a&&(x=a);return x};return b}function u(a,b,c,d){this.message=a;this.line=b;this.col=c;this.pos=d}function t(a){if(N.test(a))return parseInt(a.substr(2),16);if(M.test(a))return parseInt(a.substr(1),
8);if(Q.test(a))return parseFloat(a)}function z(a){return"$"==a||"_"==a||G(a)||E(a)}function E(a){a=a.charCodeAt(0);return 48<=a&&57>=a}function G(a){a=a.charCodeAt(0);return 65<=a&&90>=a||97<=a&&122>=a}var J=h("break,case,catch,const,continue,default,delete,do,else,finally,for,function,if,in,instanceof,new,return,switch,throw,try,typeof,var,void,while,with".split(",")),K=h("abstract,boolean,byte,char,class,debugger,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile".split(",")),
I=h("return,new,delete,throw,else,case".split(",")),O=h(["false","null","true","undefined"]),P=h("+-*&%=<>!?|~^".split("")),N=/^0x[0-9a-f]+$/i,M=/^0[0-7]+$/,Q=/^\d*\.?\d*(?:e[+-]?\d*(?:\d\.?|\.?\d)\d*)?$/i,T=h("in,instanceof,typeof,new,void,delete,++,--,+,-,!,~,&,|,^,*,/,%,>>,<<,>>>,<,>,<=,>=,==,===,!=,!==,?,=,+=,-=,/=,*=,%=,>>=,<<=,>>>=,|=,^=,&=,&&,||".split(",")),R=h(" \n\r\t".split("")),V=h("[{}(,.;:".split("")),aa=h("[]{}(),;:".split("")),ba=h("gmsiy".split(""));u.prototype.toString=function(){return this.message+
" (line: "+this.line+", col: "+this.col+", pos: "+this.pos+")"};var Y={},fa=h("typeof,void,delete,--,++,!,~,-,+".split(",")),da=h(["--","++"]),ea=function(a,b,c){for(;c<a.length;)b[a[c]]=a[c].substr(0,a[c].length-1),c++;return b}("+=,-=,/=,*=,%=,>>=,<<=,>>>=,|=,^=,&=".split(","),{"=":!0},0),Z=function(a,b){for(var c=0,d=1;c<a.length;++c,++d)for(var e=a[c],f=0;f<e.length;++f)b[e[f]]=d;return b}([["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],"<,>,<=,>=,in,instanceof".split(","),[">>","<<",
">>>"],["+","-"],["*","/","%"]],{}),ga=h(["for","do","while","switch"]),ha=h(["atom","num","string","regexp","name"]);n.prototype.toString=function(){return this.name};var ia=h("name,array,object,string,dot,sub,call,regexp".split(",")),ja=h("if,while,do,for,for-in,with".split(","));return{parse:function(a,b,c){function d(a){try{return++w.in_loop,a()}finally{--w.in_loop}}function e(a){var b;b=m(M(!0),0,a);if(C("operator","?")){D();var c=U(!1);L(":");b=B("conditional",b,c,U(!1,a))}c=w.token.value;if(C("operator")&&
f(ea,c)){if(h(b))return D(),B("assign",ea[c],b,e(a));ca("Invalid assignment")}return b}function h(a){if(!b)return!0;switch(a[0]){case "dot":case "sub":case "new":case "call":return!0;case "name":return"this"!=a[1]}}function m(a,b,c){var d=C("operator")?w.token.value:null;d&&"in"==d&&c&&(d=null);var e=null!=d?Z[d]:null;return null!=e&&e>b?(D(),e=m(M(!0),e,c),m(B("binary",d,a,e),b,c)):a}function o(a,b,c){("++"==b||"--"==b)&&!h(c)&&ca("Invalid use of "+b+" operator");return B(a,b,c)}function p(a,b){if(C("punc",
"."))return D(),p(B("dot",a,q()),b);if(C("punc","["))return D(),p(B("sub",a,j(U,l(L,"]"))),b);return b&&C("punc","(")?(D(),p(B("call",a,t(")")),!0)):b&&C("operator")&&f(da,w.token.value)?j(l(o,"unary-postfix",w.token.value,a),D):a}function q(){switch(w.token.type){case "name":case "operator":case "keyword":case "atom":return j(w.token.value,D);default:W()}}function t(a,b,c){for(var d=!0,e=[];!C("punc",a);){d?d=!1:L(",");if(b&&C("punc",a))break;C("punc",",")&&c?e.push(["atom","undefined"]):e.push(U(!1))}D();
return e}function z(){return B("const",E())}function A(a){return B("var",E(a))}function E(a){for(var b=[];;){C("name")||W();var c=w.token.value;D();C("operator","=")?(D(),b.push([c,U(!1,a)])):b.push([c]);if(!C("punc",","))break;D()}return b}function G(){L("{");for(var a=[];!C("punc","}");)C("eof")&&W(),a.push($());D();return a}function J(a){var b;T()||(b=C("name")?w.token.value:null);null!=b?(D(),g(b,w.labels)||ca("Label "+b+" without matching loop or statement")):0==w.in_loop&&ca(a+" not inside a loop or switch");
O();return B(a,b)}function K(){return B("stat",j(U,O))}function I(a){return c?function(){var b=w.token,c=a.apply(this,arguments),d=c,e=c[0],b=e instanceof n?e:new n(e,b,w.prev);d[0]=b;return c}:a}function x(){L("(");var a=U();L(")");return a}function B(){return i(arguments)}function O(){C("punc",";")?D():T()||W()}function T(){return!b&&(w.token.nlb||C("eof")||C("punc","}"))}function L(a){return za("punc",a)}function za(a,b){if(C(a,b))return D();var c=w.token;ca("Unexpected token "+w.token.type+", expected "+
a,c.line,c.col)}function W(a){null==a&&(a=w.token);ca("Unexpected token: "+a.type+" ("+a.value+")",a.line,a.col)}function ca(a,b,c,d){var e=w.input.context();throw new u(a,null!=b?b:e.tokline,null!=c?c:e.tokcol,null!=d?d:e.tokpos);}function D(){w.prev=w.token;w.peeked?(w.token=w.peeked,w.peeked=null):w.token=w.input();return w.token}function C(a,b){return w.token.type==a&&(null==b||w.token.value==b)}var w={input:"string"==typeof a?r(a,!0):a,token:null,prev:null,peeked:null,in_function:0,in_loop:0,
labels:[]};w.token=D();var $=I(function(){C("operator","/")&&(w.peeked=null,w.token=w.input(!0));switch(w.token.type){case "num":case "string":case "regexp":case "operator":case "atom":return K();case "name":var a;a=w.peeked||(w.peeked=w.input());if("punc"==a.type&&":"==a.value){a=j(w.token.value,D,D);w.labels.push(a);var c=w.token,e=$();b&&!f(ga,e[0])&&W(c);w.labels.pop();a=B("label",a,e)}else a=K();return a;case "punc":switch(w.token.value){case "{":return B("block",G());case "[":case "(":return K();
case ";":return D(),B("block");default:W()}case "keyword":switch(j(w.token.value,D)){case "break":return J("break");case "continue":return J("continue");case "debugger":return O(),B("debugger");case "do":return a=d($),za("keyword","while"),B("do",j(x,O),a);case "for":a:{L("(");a=null;if(!C("punc",";")&&(a=C("keyword","var")?(D(),A(!0)):U(!0,!0),C("operator","in"))){c="var"==a[0]?B("name",a[1][0]):a;D();e=U();L(")");a=B("for-in",a,c,e,d($));break a}L(";");c=C("punc",";")?null:U();L(";");e=C("punc",
")")?null:U();L(")");a=B("for",a,c,e,d($))}return a;case "function":return P(!0);case "if":return c=x(),e=$(),C("keyword","else")&&(D(),a=$()),B("if",c,e,a);case "return":return 0==w.in_function&&ca("'return' outside of function"),B("return",C("punc",";")?(D(),null):T()?null:j(U,O));case "switch":return B("switch",x(),N());case "throw":return B("throw",j(U,O));case "try":a=G();if(C("keyword","catch"))D(),L("("),C("name")||ca("Name expected"),e=w.token.value,D(),L(")"),e=[e,G()];C("keyword","finally")&&
(D(),c=G());!e&&!c&&ca("Missing catch/finally blocks");return B("try",a,e,c);case "var":return j(A,O);case "const":return j(z,O);case "while":return B("while",x(),d($));case "with":return B("with",x(),$());default:W()}}}),P=I(function(a){var b=C("name")?j(w.token.value,D):null;a&&!b&&W();L("(");return B(a?"defun":"function",b,function(a,b){for(;!C("punc",")");)a?a=!1:L(","),C("name")||W(),b.push(w.token.value),D();D();return b}(!0,[]),function(){++w.in_function;var a=w.in_loop;w.in_loop=0;var b=G();
--w.in_function;w.in_loop=a;return b}())}),N=l(d,function(){L("{");for(var a=[],b=null;!C("punc","}");)C("eof")&&W(),C("keyword","case")?(D(),b=[],a.push([U(),b]),L(":")):C("keyword","default")?(D(),L(":"),b=[],a.push([null,b])):(b||W(),b.push($()));D();return a}),M=I(function(a){if(C("operator","new")){D();var a=M(!1),c;C("punc","(")?(D(),c=t(")")):c=[];return p(B("new",a,c),!0)}if(C("operator")&&f(fa,w.token.value))return o("unary-prefix",j(w.token.value,D),M(a));if(C("punc")){switch(w.token.value){case "(":return D(),
p(j(U,l(L,")")),a);case "[":return D(),p(B("array",t("]",!b,!0)),a);case "{":D();c=p;var d;d=!0;for(var e=[];!C("punc","}");){d?d=!1:L(",");if(!b&&C("punc","}"))break;var g=w.token.type,i;a:{switch(w.token.type){case "num":case "string":i=j(w.token.value,D);break a}i=q()}"name"!=g||"get"!=i&&"set"!=i||C("punc",":")?(L(":"),e.push([i,U(!1)])):e.push([q(),P(!1),i])}D();d=B("object",e);return c(d,a)}W()}if(C("keyword","function"))return D(),p(P(!1),a);if(f(ha,w.token.type))return c="regexp"==w.token.type?
B("regexp",w.token.value[0],w.token.value[1]):B(w.token.type,w.token.value),p(j(c,D),a);W()}),U=I(function(a,b){0==arguments.length&&(a=!0);var c=e(b);return a&&C("punc",",")?(D(),B("seq",c,U(!0,b))):c});return B("toplevel",function(a){for(;!C("eof");)a.push($());return a}([]))},gen_code:function(h,j){function l(a){var b=a[0],c=Y[b];if(!c)throw Error("Can't find generator for \""+b+'"');L.push(a);a=c.apply(b,a.slice(1));L.pop();return a}function n(a){var b=a[0],a=a[1];null!=a&&(b=S([Q(b),"=",I(a,
"seq")]));return b}function r(a){return a?0==a.length?"{}":"{"+B+P(function(){return t(a).join(B)})+B+N("}"):";"}function u(b){var c=b.length;return 0==c?"{}":"{"+B+a(b,function(a,b){var d=0<a[1].length,e=P(function(){return N(a[0]?S(["case",l(a[0])+":"]):"default:")},0.5)+(d?B+P(function(){return t(a[1]).join(B)}):"");!R&&d&&b<c-1&&(e+=";");return e}).join(B)+B+N("}")}function t(b,c){for(var e=[],f=b.length-1,i=0;i<=f;++i){var h=b[i],j=l(h);";"!=j&&(!R&&i==f&&("while"==h[0]&&d(h[2])||g(h[0],["for",
"for-in"])&&d(h[4])||"if"==h[0]&&d(h[2])&&!h[3]||"if"==h[0]&&h[3]&&d(h[3])?j=j.replace(/;*\s*$/,";"):j=j.replace(/;+\s*$/,"")),e.push(j))}return c?e:a(e,N)}function z(b,c,d,e){e=e||"function";b&&(e+=" "+Q(b));e+="("+M(a(c,Q))+")";return S([e,r(d)])}function A(a){var b=a.toString(10),c=[b.replace(/^0\./,".")],d;Math.floor(a)===a?(c.push("0x"+a.toString(16).toLowerCase(),"0"+a.toString(8)),(d=/^(.*?)(0+)$/.exec(a))&&c.push(d[1]+"e"+d[2].length)):(d=/^0?\.(0+)(.*)$/.exec(a))&&c.push(d[2]+"e-"+(d[1].length+
d[2].length),b.substr(b.indexOf(".")));return H(c)}function F(a){if("function"==a[0]||"object"==a[0])for(var b=i(L),c=b.pop(),d=b.pop();d;){if("stat"==d[0])return!0;if(("seq"==d[0]||"call"==d[0]||"dot"==d[0]||"sub"==d[0]||"conditional"==d[0])&&d[1]===c||("binary"==d[0]||"assign"==d[0]||"unary-postfix"==d[0])&&d[2]===c)c=d,d=b.pop();else return!1}return!f(ia,a[0])}function H(a){if(1==a.length)return a[0];if(2==a.length){var b=a[1],a=a[0];return a.length<=b.length?a:b}return H([a[0],H(a.slice(1))])}
function I(a){for(var b=l(a),c=1;c<arguments.length;++c){var d=arguments[c];if(d instanceof Function&&d(a)||a[0]==d)return"("+b+")"}return b}function M(a){return a.join(","+V)}function S(a){if(R)return a.join(" ");for(var b=[],c=0;c<a.length;++c){var d=a[c+1];b.push(a[c]);d&&(/[a-z0-9_\x24]$/i.test(a[c].toString())&&/^[a-z0-9_\x24]/i.test(d.toString())||/[\+\-]$/.test(a[c].toString())&&/^[\+\-]/.test(d.toString()))&&b.push(" ")}return b.join("")}function P(a,b){null==b&&(b=1);x+=b;try{return a.apply(null,
i(arguments,1))}finally{x-=b}}function N(a){null==a&&(a="");R&&(a=(1>j.indent_start+x*j.indent_level?"":Array(j.indent_start+x*j.indent_level+1).join(" "))+a);return a}function Q(a){return a.toString()}var j=b(j,{indent_start:0,indent_level:4,quote_keys:!1,space_colon:!1,beautify:!1}),R=!!j.beautify,x=0,B=R?"\n":"",V=R?" ":"",Y={string:c,num:A,name:Q,toplevel:function(a){return t(a).join(B)},splice:function(b){return f(ja,L[L.length-2][0])?r.apply(this,arguments):a(t(b,!0),function(a,b){return 0<
b?N(a):a}).join(B)},block:r,"var":function(b){return"var "+M(a(b,n))+";"},"const":function(b){return"const "+M(a(b,n))+";"},"try":function(a,b,c){a=["try",r(a)];b&&a.push("catch","("+b[0]+")",r(b[1]));c&&a.push("finally",r(c));return S(a)},"throw":function(a){return S(["throw",l(a)])+";"},"new":function(b,c){c=0<c.length?"("+M(a(c,l))+")":"";return S(["new",I(b,"seq","binary","conditional","assign",function(a){var b=e(),c={};try{b.with_walkers({call:function(){throw c;},"function":function(){return this}},
function(){b.walk(a)})}catch(d){if(d===c)return!0;throw d;}})+c])},"switch":function(a,b){return S(["switch","("+l(a)+")",u(b)])},"break":function(a){var b="break";null!=a&&(b+=" "+Q(a));return b+";"},"continue":function(a){var b="continue";null!=a&&(b+=" "+Q(a));return b+";"},conditional:function(a,b,c){return S([I(a,"assign","seq","conditional"),"?",I(b,"seq"),":",I(c,"seq")])},assign:function(a,b,c){a&&!0!==a?a+="=":a="=";return S([l(b),a,I(c,"seq")])},dot:function(a){var b=l(a),c=1;for("num"==
a[0]?/\./.test(a[1])||(b+="."):F(a)&&(b="("+b+")");c<arguments.length;)b+="."+Q(arguments[c++]);return b},call:function(b,c){var d=l(b);F(b)&&(d="("+d+")");return d+"("+M(a(c,function(a){return I(a,"seq")}))+")"},"function":z,defun:z,"if":function(a,b,c){a="("+l(a)+")";if(c)a:if("do"==b[0])b=l(["block",[b]]);else{for(var d=b;;){var e=d[0];if("if"==e){if(!d[3]){b=l(["block",[b]]);break a}d=d[3]}else if("while"==e||"do"==e)d=d[2];else if("for"==e||"for-in"==e)d=d[4];else break}b=l(b)}else b=l(b);b=
["if",a,b];c&&b.push("else",l(c));return S(b)},"for":function(a,b,c,d){var e=["for"];a=(null!=a?l(a):"").replace(/;*\s*$/,";"+V);b=(null!=b?l(b):"").replace(/;*\s*$/,";"+V);c=(null!=c?l(c):"").replace(/;*\s*$/,"");a=a+b+c;"; ; "==a&&(a=";;");e.push("("+a+")",l(d));return S(e)},"for-in":function(a,b,c,d){return S(["for","("+(a?l(a).replace(/;+$/,""):l(b)),"in",l(c)+")",l(d)])},"while":function(a,b){return S(["while","("+l(a)+")",l(b)])},"do":function(a,b){return S(["do",l(b),"while","("+l(a)+")"])+
";"},"return":function(a){var b=["return"];null!=a&&b.push(l(a));return S(b)+";"},binary:function(a,b,c){var d=l(b),e=l(c);if(g(b[0],["assign","conditional","seq"])||"binary"==b[0]&&Z[a]>Z[b[1]])d="("+d+")";if(g(c[0],["assign","conditional","seq"])||"binary"==c[0]&&Z[a]>=Z[c[1]]&&(c[1]!=a||!g(a,["&&","||","*"])))e="("+e+")";return S([d,a,e])},"unary-prefix":function(a,b){var c=l(b);"num"==b[0]||"unary-prefix"==b[0]&&!f(T,a+b[1])||!F(b)||(c="("+c+")");var d;d=a.charAt(0);d=E(d)||G(d);return a+(d?" ":
"")+c},"unary-postfix":function(a,b){var c=l(b);"num"==b[0]||"unary-postfix"==b[0]&&!f(T,a+b[1])||!F(b)||(c="("+c+")");return c+a},sub:function(a,b){var c=l(a);F(a)&&(c="("+c+")");return c+"["+l(b)+"]"},object:function(b){return 0==b.length?"{}":"{"+B+P(function(){return a(b,function(a){if(3==a.length)return N(z(a[0],a[1][2],a[1][3],a[2]));var b=a[0],a=l(a[1]);j.quote_keys?b=c(b):("number"==typeof b||!R&&+b+""==b)&&0<=parseFloat(b)?b=A(+b):/^[a-z_$][a-z0-9_$]*$/i.test(b)&&"this"!=b&&!f(O,b)&&!f(K,
b)&&!f(J,b)||(b=c(b));return N(S(R&&j.space_colon?[b,":",a]:[b+":",a]))}).join(","+B)})+B+N("}")},regexp:function(a,b){return"/"+a+"/"+b},array:function(b){return 0==b.length?"[]":S(["[",M(a(b,function(a){return!R&&"atom"==a[0]&&"undefined"==a[1]?"":I(a,"seq")})),"]"])},stat:function(a){return l(a).replace(/;*\s*$/,";")},seq:function(){return M(a(i(arguments),l))},label:function(a,b){return S([Q(a),":",l(b)])},"with":function(a,b){return S(["with","("+l(a)+")",l(b)])},atom:function(a){return Q(a)}},
L=[];return l(h)},tokenizer:r,ast_walker:e}},h={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"modulo","==":"equals","!=":"equals"},j={"-":"negate"};G.add(window,{load:f});return{compile:c,evaluate:d,load:f,getAttribute:i("get"),hasAttribute:i("has")}};this.load=fa.load;n.each(this,function(a,b){if(a&&a.prototype instanceof n)a._name=b});this.enumerable=!0;return new (Y.inject(this))};
